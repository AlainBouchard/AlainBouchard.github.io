<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.136.1">
    <meta name="generator" content="Relearn 7.0.1+72a875f1db967152c77914cff4d53f8fcee0e619">
    <meta name="description" content="Warning 2022-07-11: This is a WORK IN PROGRESS document (WIP) and need to be reviewed.
Apache Kafka Topics, partitions and offsets Brokers Brokers and topics Topic replication factor Producers Consumers Consumer offsets Kafka broker discovery Zookeeper Kafka guarantees Install Kafka using Docker images Use Kafka Topics CLI Topics CLI Kafka console producer Kafka console consumer Kafka-Client with Java Kafka Connect and Kafka Stream Apache Kafka Why Apache Kafka?">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Apache Kafka (WIP) :: Alain Bouchard&#39;s Engineering Notes">
    <meta name="twitter:description" content="Warning 2022-07-11: This is a WORK IN PROGRESS document (WIP) and need to be reviewed.
Apache Kafka Topics, partitions and offsets Brokers Brokers and topics Topic replication factor Producers Consumers Consumer offsets Kafka broker discovery Zookeeper Kafka guarantees Install Kafka using Docker images Use Kafka Topics CLI Topics CLI Kafka console producer Kafka console consumer Kafka-Client with Java Kafka Connect and Kafka Stream Apache Kafka Why Apache Kafka?">
    <meta property="og:url" content="https://AlainBouchard.github.io/notes/apache-kafka/index.html">
    <meta property="og:site_name" content="Alain Bouchard&#39;s Engineering Notes">
    <meta property="og:title" content="Apache Kafka (WIP) :: Alain Bouchard&#39;s Engineering Notes">
    <meta property="og:description" content="Warning 2022-07-11: This is a WORK IN PROGRESS document (WIP) and need to be reviewed.
Apache Kafka Topics, partitions and offsets Brokers Brokers and topics Topic replication factor Producers Consumers Consumer offsets Kafka broker discovery Zookeeper Kafka guarantees Install Kafka using Docker images Use Kafka Topics CLI Topics CLI Kafka console producer Kafka console consumer Kafka-Client with Java Kafka Connect and Kafka Stream Apache Kafka Why Apache Kafka?">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="My Notes">
    <meta itemprop="name" content="Apache Kafka (WIP) :: Alain Bouchard&#39;s Engineering Notes">
    <meta itemprop="description" content="Warning 2022-07-11: This is a WORK IN PROGRESS document (WIP) and need to be reviewed.
Apache Kafka Topics, partitions and offsets Brokers Brokers and topics Topic replication factor Producers Consumers Consumer offsets Kafka broker discovery Zookeeper Kafka guarantees Install Kafka using Docker images Use Kafka Topics CLI Topics CLI Kafka console producer Kafka console consumer Kafka-Client with Java Kafka Connect and Kafka Stream Apache Kafka Why Apache Kafka?">
    <meta itemprop="wordCount" content="6991">
    <title>Apache Kafka (WIP) :: Alain Bouchard&#39;s Engineering Notes</title>
    <link href="/css/fontawesome-all.min.css?1731979209" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fontawesome-all.min.css?1731979209" rel="stylesheet"></noscript>
    <link href="/css/nucleus.css?1731979209" rel="stylesheet">
    <link href="/css/auto-complete.css?1731979209" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/auto-complete.css?1731979209" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar.min.css?1731979209" rel="stylesheet">
    <link href="/css/fonts.css?1731979209" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fonts.css?1731979209" rel="stylesheet"></noscript>
    <link href="/css/theme.css?1731979209" rel="stylesheet">
    <link href="/css/theme-blue.css?1731979209" rel="stylesheet" id="R-variant-style">
    <link href="/css/chroma-learn.css?1731979209" rel="stylesheet" id="R-variant-chroma-style">
    <link href="/css/print.css?1731979209" rel="stylesheet" media="print">
    <script src="/js/variant.js?1731979209"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='https:\/\/AlainBouchard.github.io';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      // variant stuff
      window.variants && variants.init( [ 'blue' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
  </head>
  <body class="mobile-support html" data-url="/notes/apache-kafka/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/index.html"><span itemprop="name">Alain Bouchard&#39;s Engineering Notes and Blogs</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/notes/index.html"><span itemprop="name">My Notes</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Apache Kafka (WIP)</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/notes/index.html" title="My Notes (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/notes/cypress/index.html" title="Cypress with TypeScript (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable notes" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="apache-kafka-wip">Apache Kafka (WIP)</h1>

<div class="box notices cstyle warning">
  <div class="box-label">
    <i class="fa-fw fas fa-exclamation-triangle"></i> Warning
  </div>
  <div class="box-content">
<p>2022-07-11: This is a WORK IN PROGRESS document (WIP) and need to be reviewed.</p>
  </div>
</div>
<div class="toc">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#apache-kafka">Apache Kafka</a>
      <ul>
        <li><a href="#topics-partitions-and-offsets">Topics, partitions and offsets</a></li>
        <li><a href="#brokers">Brokers</a></li>
        <li><a href="#brokers-and-topics">Brokers and topics</a></li>
        <li><a href="#topic-replication-factor">Topic replication factor</a></li>
        <li><a href="#producers">Producers</a></li>
        <li><a href="#consumers">Consumers</a></li>
        <li><a href="#consumer-offsets">Consumer offsets</a></li>
        <li><a href="#kafka-broker-discovery">Kafka broker discovery</a></li>
        <li><a href="#zookeeper">Zookeeper</a></li>
        <li><a href="#kafka-guarantees">Kafka guarantees</a></li>
        <li><a href="#install-kafka-using-docker-images">Install Kafka using Docker images</a></li>
        <li><a href="#use-kafka-topics-cli">Use Kafka Topics CLI</a></li>
        <li><a href="#topics-cli">Topics CLI</a></li>
        <li><a href="#kafka-console-producer">Kafka console producer</a></li>
        <li><a href="#kafka-console-consumer">Kafka console consumer</a></li>
        <li><a href="#kafka-client-with-java">Kafka-Client with Java</a></li>
        <li><a href="#kafka-connect-and-kafka-stream">Kafka Connect and Kafka Stream</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div>
<h2 id="apache-kafka">Apache Kafka</h2>
<p>Why Apache Kafka?</p>
<ul>
<li>Created by LinkedIn, now Open Source Project Maintained by Confluent (Apache Stewardship)</li>
<li>Distributedm resilient architecture, fault tolerant</li>
<li>scales Horizontaly (100s of borkers, millions of messages per seconds, etc.)</li>
</ul>
<p>Use Cases?</p>
<ul>
<li>Messaging system</li>
<li>Activity tracking</li>
<li>Gather metrics from many different locations</li>
<li>Application logs gathering</li>
<li>Stream processing (e.g., kafka stream API, Apache Spark, etc.)</li>
<li>De-coupliung system dependicies</li>
<li>Integration with Spark, Flink, Storm, Hadoop, and other big Data technologies</li>
</ul>
<h3 id="topics-partitions-and-offsets">Topics, partitions and offsets</h3>
<ul>
<li>
<p><code>Topics</code>: a particular stream of data</p>
<ul>
<li>similar to a table in a DB (but without the constraints)</li>
<li>you can have as many topics as you want</li>
<li>a topic is identified by its name</li>
</ul>
</li>
<li>
<p><code>Partitions</code>: spliting topics</p>
<ul>
<li>each partiction is orderied</li>
<li>each message within a partiction gets an incremental id, called <code>offset</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>            | Partition 0 -&gt; offset: | 0 | 1 | 2 | 3 | 4 | 5 | ...
</span></span><span style="display:flex;"><span>            |
</span></span><span style="display:flex;"><span>Kafka Topic + Partition 1 -&gt; offset: | 0 | 1 | 2 | ... writes
</span></span><span style="display:flex;"><span>            |
</span></span><span style="display:flex;"><span>            | Partition 2 -&gt; offset: | 0 | 1 | 2 | 3 | 4 | ...</span></span></code></pre></div>
<ul>
<li>offset only have a meaning for a specific partiction (e.g., ofsset 3 in partition 0 != offset 3 in partition 1)</li>
<li>order is guaranteed only within a partition (not acresoo partitions)</li>
<li>data is kept only for a limited time (default is one week)</li>
<li>once the data is written to a partition, it can&rsquo;t be changed (immutability)</li>
<li>data is assigned randomly to a partition unless a key is provided (more on this later)</li>
</ul>
</li>
</ul>
<h3 id="brokers">Brokers</h3>
<ul>
<li>a <code>kafka cluster</code> in composed of multiple brokers (broker = servers)</li>
<li>each broker is identified with its ID (integer)</li>
<li>each broker contains certain topic partitions</li>
<li>after connecting to any broker (called a bootstrap broker), you will be connected to the intire cluster</li>
<li>a good number to get started is <code>3 brokers</code>, but may go over 100 brokers</li>
</ul>
<h3 id="brokers-and-topics">Brokers and topics</h3>
<ul>
<li>Example of Topic-A with 3 partitions</li>
<li>Exmaple of Topic-B with 2 partitions</li>
</ul>
<table>
  <thead>
      <tr>
          <th style="text-align: center">Broker 101</th>
          <th style="text-align: center">Broker 102</th>
          <th style="text-align: center">Broker 103</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">Topic A partition 0</td>
          <td style="text-align: center">Topic A partition 2</td>
          <td style="text-align: center">Topic A partition 1</td>
      </tr>
      <tr>
          <td style="text-align: center">Topic A partition 1</td>
          <td style="text-align: center">Topic A partition 0</td>
          <td style="text-align: center"></td>
      </tr>
  </tbody>
</table>
<h3 id="topic-replication-factor">Topic replication factor</h3>
<ul>
<li>topics should have a replication factor &gt; 1 (usually between 2 and 3)</li>
<li>this way if a broker is down, another broker can serve the data</li>
<li>example: topic-A with 2 partitions and replications factor of 2</li>
</ul>
<table>
  <thead>
      <tr>
          <th style="text-align: center">Broker 101</th>
          <th style="text-align: center">Broker 102</th>
          <th style="text-align: center">Broker 103</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">Topic-A Partition 0</td>
          <td style="text-align: center">Topic-A Partition 1</td>
          <td style="text-align: center">Topic-A Partition 1</td>
      </tr>
      <tr>
          <td style="text-align: center"></td>
          <td style="text-align: center">Topic-A Partition 0</td>
          <td style="text-align: center"></td>
      </tr>
  </tbody>
</table>
<ul>
<li>example: broker 102 goes down; broker 101 and 103 still up, both partitions still work</li>
<li>at any time only <code>one broker</code> can be a leader for a given partition</li>
<li>only that leader can receive and serve data for a partition</li>
<li>the other brokers will synchronize the data</li>
<li>therefore each partion has one leader and multiple ISR (in-sync replica)</li>
</ul>
<h3 id="producers">Producers</h3>
<ul>
<li>producers write data to topics (which is made of partitions)</li>
<li>producers automatically know to which broker and partition to write to</li>
<li>in case of broker failures, producers will automatically recover</li>
<li>producers can choose to receive acknowledgement of data writes
<ul>
<li>acks=0: producers won&rsquo;t wait for acknowledgment (possible data loss)</li>
<li>(default) acks=1: producer will wait for leader acknowledgment (limited data loss)</li>
<li>acks=all: leaders and replicas acknowledgment (no data loss)</li>
</ul>
</li>
</ul>
<h4 id="message-keys">Message keys</h4>
<ul>
<li>producers can choose to send a <code>key</code> with the message (string, number, etc.)</li>
<li>if key=null, data is sent round robin (broker 101, 102 then 103, and 101 again&hellip;)</li>
<li>if a key is sent, then all messages for that key will always goto the same partition</li>
<li>a key is basically sent if you need a message ordering for specific field (e.g., truck_id, etc.)
<ul>
<li>we get this guarantee due to key hashing, which depends on the number of partitions</li>
</ul>
</li>
</ul>
<h3 id="consumers">Consumers</h3>
<ul>
<li>consumers read data from a tipic (identified by name)</li>
<li>consumers know which broker to read from</li>
<li>in case of broker failures, consumer know how to recover</li>
<li>data is read in order <code>within each partitions</code></li>
</ul>
<h4 id="consumers-groups">Consumers groups</h4>
<ul>
<li>consumers read data in consumer groups</li>
<li>each consumer within a group reads from exclusinve partitions</li>
<li>if youy have more consumer than partitions, some consumers with be icative</li>
<li><strong>if you have more consumers than partitions, some consumers will be inactive</strong></li>
</ul>
<h3 id="consumer-offsets">Consumer offsets</h3>
<ul>
<li><code>kafka</code> stores the offsets at which a consumer group has beed reading</li>
<li>the offset committed live in a kafka <code>topic</code> named <code>__consumer_offsets</code></li>
<li>when a consumer in a group has processed data received from kafka, it should be committing the offsets</li>
<li>if a consumer dies, it will be able to read back from where it left off (due to the committed consumer offsets)</li>
</ul>
<h4 id="delivery-semantics-for-consumers">Delivery semantics for consumers</h4>
<ul>
<li>consumers choose when to commit offsets</li>
<li>there are 3 delivery semantics</li>
<li>at most once:
<ul>
<li>offsets are committed as soon as the message is received
<ul>
<li>offsets are commited as soon as the message is received</li>
<li>if the processing goes wring, the message will be lost (it won&rsquo;t be read again)</li>
</ul>
</li>
<li>at least once (usually preferred)
<ul>
<li>offsets are committed after the message is processed</li>
<li>if the processing goes wring, the message will be read again</li>
<li>this can reults in duplicate processing of messages, so make sure the processing is <code>idempotent</code></li>
</ul>
</li>
<li>exactly once
<ul>
<li>can be achieved for <code>kafta-to-kafka</code> workflows using kafka streams API</li>
<li>for <code>kafka-to-external-system workflows</code>, it requires the consumer to be <code>idempotent</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="kafka-broker-discovery">Kafka broker discovery</h3>
<ul>
<li>every kafka broker is also called a <code>bootstrap server</code></li>
<li>that means that <code>you only need to connect to one broker</code> and you will be connected to the entire cluster</li>
<li>each broker knows about all brokers, topics and partitions (metadata)</li>
</ul>
<h3 id="zookeeper">Zookeeper</h3>
<ul>
<li>zookeeper manages brokers (keeps a list of them)</li>
<li>zookeeper helps in performing leader election partitions</li>
<li>zookeeper sends notifications to kafka in case of changes (e.g., new topic, broker dies, brker comes up, delete topics, etc.)</li>
<li><em>kafka can&rsquo;t work without zookeeper</em></li>
<li>zookeeper <em>by design</em> operates with an odd number of servers (3, 5, 7, &hellip;)</li>
<li>zookeeper has a leader (handle writes) and the rest if the servers are followers (handle reads)</li>
<li>zookeeper <code>does not</code> store consumer offsets with kafka &gt; v0.10</li>
</ul>
<h3 id="kafka-guarantees">Kafka guarantees</h3>
<ul>
<li>Messages are appended to a <code>topic-partition</code> in othe order they are sent</li>
<li>consumers read messages in the order stored in a <code>topic-partition</code></li>
<li>with a replication factor of N, producers and consumers can tolerate up to <code>N-1</code> brokers being down</li>
<li>this is why a replicator factor of 4 is a good idea:
<ul>
<li>allows for one broker to be taken down for maintenance</li>
<li>allows for another broker to be taken down unexpectedly</li>
</ul>
</li>
<li>as long as the number of partitions remains constant for a topic (no new partitions), the same key will always go to the same partition (i.e., hashed key)</li>
</ul>
<h3 id="install-kafka-using-docker-images">Install Kafka using Docker images</h3>
<p>Create the <code>docker-compose.yaml</code> file:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3.5&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">zookeeper</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-zookeeper:latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_CLIENT_PORT</span>: <span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_TICK_TIME</span>: <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">22181</span>:<span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kafka</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka:latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">29092</span>:<span style="color:#ae81ff">29092</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_BROKER_ID</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ZOOKEEPER_CONNECT</span>: <span style="color:#ae81ff">zookeeper:2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">PLAINTEXT://kafka:9092,PLAINTEXT_HOST://localhost:29092</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style="color:#ae81ff">PLAINTEXT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span>: <span style="color:#ae81ff">1</span></span></span></code></pre></div>
<p>From the CLI:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; docker-compose up -d
</span></span><span style="display:flex;"><span>&gt; docker ps
</span></span><span style="display:flex;"><span>CONTAINER ID   IMAGE                              COMMAND                  CREATED          STATUS          PORTS                                         NAMES
</span></span><span style="display:flex;"><span>ab09b5c8bc7b   confluentinc/cp-kafka:latest       <span style="color:#e6db74">&#34;/etc/confluent/dock…&#34;</span>   <span style="color:#ae81ff">11</span> minutes ago   Up <span style="color:#ae81ff">11</span> minutes   9092/tcp, 0.0.0.0:29092-&gt;29092/tcp            kafka-cluster_kafka_1
</span></span><span style="display:flex;"><span>8e7725b7874b   confluentinc/cp-zookeeper:latest   <span style="color:#e6db74">&#34;/etc/confluent/dock…&#34;</span>   <span style="color:#ae81ff">11</span> minutes ago   Up <span style="color:#ae81ff">11</span> minutes   2888/tcp, 3888/tcp, 0.0.0.0:22181-&gt;2181/tcp   kafka-cluster_zookeeper_1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt; $ netstat -aon | grep <span style="color:#ae81ff">22181</span>
</span></span><span style="display:flex;"><span>  TCP    0.0.0.0:22181          0.0.0.0:0              LISTENING       <span style="color:#ae81ff">23792</span>
</span></span><span style="display:flex;"><span>  TCP    <span style="color:#f92672">[</span>::<span style="color:#f92672">]</span>:22181             <span style="color:#f92672">[</span>::<span style="color:#f92672">]</span>:0                 LISTENING       <span style="color:#ae81ff">23792</span>
</span></span><span style="display:flex;"><span>  TCP    <span style="color:#f92672">[</span>::1<span style="color:#f92672">]</span>:22181            <span style="color:#f92672">[</span>::<span style="color:#f92672">]</span>:0                 LISTENING       <span style="color:#ae81ff">27612</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt; netstat -aon | grep <span style="color:#ae81ff">29092</span>
</span></span><span style="display:flex;"><span>  TCP    0.0.0.0:29092          0.0.0.0:0              LISTENING       <span style="color:#ae81ff">23792</span>
</span></span><span style="display:flex;"><span>  TCP    <span style="color:#f92672">[</span>::<span style="color:#f92672">]</span>:29092             <span style="color:#f92672">[</span>::<span style="color:#f92672">]</span>:0                 LISTENING       <span style="color:#ae81ff">23792</span>
</span></span><span style="display:flex;"><span>  TCP    <span style="color:#f92672">[</span>::1<span style="color:#f92672">]</span>:29092            <span style="color:#f92672">[</span>::<span style="color:#f92672">]</span>:0                 LISTENING       <span style="color:#ae81ff">27612</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt; docker-compose logs kafka | grep -i started
</span></span><span style="display:flex;"><span>kafka_1      | <span style="color:#f92672">[</span>2022-05-31 14:49:34,438<span style="color:#f92672">]</span> DEBUG <span style="color:#f92672">[</span>ReplicaStateMachine controllerId<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> Started replica state machine with initial state -&gt; HashMap<span style="color:#f92672">()</span> <span style="color:#f92672">(</span>kafka.controller.ZkReplicaStateMachine<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>kafka_1      | <span style="color:#f92672">[</span>2022-05-31 14:49:34,441<span style="color:#f92672">]</span> DEBUG <span style="color:#f92672">[</span>PartitionStateMachine controllerId<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> Started partition state machine with initial state -&gt; HashMap<span style="color:#f92672">()</span> <span style="color:#f92672">(</span>kafka.controller.ZkPartitionStateMachine<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>kafka_1      | <span style="color:#f92672">[</span>2022-05-31 14:49:34,445<span style="color:#f92672">]</span> INFO <span style="color:#f92672">[</span>SocketServer listenerType<span style="color:#f92672">=</span>ZK_BROKER, nodeId<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> Started data-plane acceptor and processor<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> <span style="color:#66d9ef">for</span> endpoint : ListenerName<span style="color:#f92672">(</span>PLAINTEXT<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>kafka.network.SocketServer<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>kafka_1      | <span style="color:#f92672">[</span>2022-05-31 14:49:34,450<span style="color:#f92672">]</span> INFO <span style="color:#f92672">[</span>SocketServer listenerType<span style="color:#f92672">=</span>ZK_BROKER, nodeId<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> Started data-plane acceptor and processor<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> <span style="color:#66d9ef">for</span> endpoint : ListenerName<span style="color:#f92672">(</span>PLAINTEXT_HOST<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>kafka.network.SocketServer<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>kafka_1      | <span style="color:#f92672">[</span>2022-05-31 14:49:34,450<span style="color:#f92672">]</span> INFO <span style="color:#f92672">[</span>SocketServer listenerType<span style="color:#f92672">=</span>ZK_BROKER, nodeId<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> Started socket server acceptors and processors <span style="color:#f92672">(</span>kafka.network.SocketServer<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>kafka_1      | <span style="color:#f92672">[</span>2022-05-31 14:49:34,459<span style="color:#f92672">]</span> INFO <span style="color:#f92672">[</span>KafkaServer id<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> started <span style="color:#f92672">(</span>kafka.server.KafkaServer<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>kafka_1      | <span style="color:#f92672">[</span>2022-05-31 18:51:50,791<span style="color:#f92672">]</span> DEBUG <span style="color:#f92672">[</span>ReplicaStateMachine controllerId<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> Started replica state machine with initial state -&gt; HashMap<span style="color:#f92672">()</span> <span style="color:#f92672">(</span>kafka.controller.ZkReplicaStateMachine<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>kafka_1      | <span style="color:#f92672">[</span>2022-05-31 18:51:50,791<span style="color:#f92672">]</span> DEBUG <span style="color:#f92672">[</span>PartitionStateMachine controllerId<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> Started partition state machine with initial state -&gt; HashMap<span style="color:#f92672">()</span> <span style="color:#f92672">(</span>kafka.controller.ZkPartitionStateMachine<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>kafka_1      | <span style="color:#f92672">[</span>2022-05-31 19:52:52,922<span style="color:#f92672">]</span> DEBUG <span style="color:#f92672">[</span>ReplicaStateMachine controllerId<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> Started replica state machine with initial state -&gt; HashMap<span style="color:#f92672">()</span> <span style="color:#f92672">(</span>kafka.controller.ZkReplicaStateMachine<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>kafka_1      | <span style="color:#f92672">[</span>2022-05-31 19:52:52,923<span style="color:#f92672">]</span> DEBUG <span style="color:#f92672">[</span>PartitionStateMachine controllerId<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> Started partition state machine with initial state -&gt; HashMap<span style="color:#f92672">()</span> <span style="color:#f92672">(</span>kafka.controller.ZkPartitionStateMachine<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>kafka_1      | <span style="color:#f92672">[</span>2022-05-31 21:02:51,738<span style="color:#f92672">]</span> DEBUG <span style="color:#f92672">[</span>ReplicaStateMachine controllerId<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> Started replica state machine with initial state -&gt; HashMap<span style="color:#f92672">()</span> <span style="color:#f92672">(</span>kafka.controller.ZkReplicaStateMachine<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>kafka_1      | <span style="color:#f92672">[</span>2022-05-31 21:02:51,739<span style="color:#f92672">]</span> DEBUG <span style="color:#f92672">[</span>PartitionStateMachine controllerId<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> Started partition state machine with initial state -&gt; HashMap<span style="color:#f92672">()</span> <span style="color:#f92672">(</span>kafka.controller.ZkPartitionStateMachine<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>kafka_1      | <span style="color:#f92672">[</span>2022-05-31 23:24:34,226<span style="color:#f92672">]</span> DEBUG <span style="color:#f92672">[</span>ReplicaStateMachine controllerId<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> Started replica state machine with initial state -&gt; HashMap<span style="color:#f92672">()</span> <span style="color:#f92672">(</span>kafka.controller.ZkReplicaStateMachine<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>kafka_1      | <span style="color:#f92672">[</span>2022-05-31 23:24:34,226<span style="color:#f92672">]</span> DEBUG <span style="color:#f92672">[</span>PartitionStateMachine controllerId<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> Started partition state machine with initial state -&gt; HashMap<span style="color:#f92672">()</span> <span style="color:#f92672">(</span>kafka.controller.ZkPartitionStateMachine<span style="color:#f92672">)</span></span></span></code></pre></div>
<p>Note: <code>nc -z localhost &lt;port&gt;</code> can be used on MacOS and linux.</p>
<p>Follow the <a href="https://www.baeldung.com/ops/kafka-docker-setup" rel="external" target="_blank">Guide to Setting Up Apache Kafka Using Docker</a> instructions.</p>
<p>Install the <a href="https://kafkatool.com/download.html" rel="external" target="_blank">Kafka Offset Explorer</a> to connect to Kafka Cluster and make sure to configure the bootstrap server: <code>localhost:29092</code></p>
<h3 id="use-kafka-topics-cli">Use Kafka Topics CLI</h3>
<p>Use <code>docker</code> to execute the <code>kafka-topics</code> command:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; docker-compose ps
</span></span><span style="display:flex;"><span>          Name                       Command            State                      Ports
</span></span><span style="display:flex;"><span>-----------------------------------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>kafka-cluster_kafka_1       /etc/confluent/docker/run   Up      0.0.0.0:29092-&gt;29092/tcp, 9092/tcp
</span></span><span style="display:flex;"><span>kafka-cluster_zookeeper_1   /etc/confluent/docker/run   Up      0.0.0.0:22181-&gt;2181/tcp, 2888/tcp, 3888/tcp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt; docker exec -t kafka-cluster_kafka_1 kafka-topics
</span></span><span style="display:flex;"><span>Create, delete, describe, or change a topic.
</span></span><span style="display:flex;"><span>Option                                   Description
</span></span><span style="display:flex;"><span>------                                   -----------
</span></span><span style="display:flex;"><span>--alter                                  Alter the number of partitions,
</span></span><span style="display:flex;"><span>                                           replica assignment, and/or
</span></span><span style="display:flex;"><span>                                           configuration <span style="color:#66d9ef">for</span> the topic.
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>.</span></span></code></pre></div>
<p>To use Kafka Container shell:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; docker exec -it kafka-cluster_kafka_1 sh
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<h3 id="topics-cli">Topics CLI</h3>
<p>Reference: <a href="https://medium.com/@TimvanBaarsen/apache-kafka-cli-commands-cheat-sheet-a6f06eac01b#8c2f" rel="external" target="_blank">Apache Kafka CLI commands cheat sheet</a></p>
<h4 id="creating-a-topic">Creating a topic</h4>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-topics --bootstrap-server localhost:9092 --create --topic first_topic --partitions <span style="color:#ae81ff">3</span> --replication-factor <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>WARNING: Due to limitations in metric names, topics with a period <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;.&#39;</span><span style="color:#f92672">)</span> or underscore <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;_&#39;</span><span style="color:#f92672">)</span> could collide. To avoid issues it is best to use either, but not both.
</span></span><span style="display:flex;"><span>Created topic first_topic.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<p>Note: the <code>--bootstrap-server localhost:9092</code> replaces the <code>kafka-topics</code> command <code>--zookeeper localhost:9092</code></p>
<h4 id="listing-current-topics">Listing current topics</h4>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-topics --bootstrap-server localhost:9092 --list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>first_topic
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<h4 id="describe-a-topic">Describe a topic</h4>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-topics --bootstrap-server localhost:9092 --describe --topic first_topic
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Topic: first_topic      TopicId: vQ6o8fX1Sx-qNQuUQ5vbAg PartitionCount: <span style="color:#ae81ff">3</span>       ReplicationFactor: <span style="color:#ae81ff">1</span>    Configs:
</span></span><span style="display:flex;"><span>        Topic: first_topic      Partition: <span style="color:#ae81ff">0</span>    Leader: <span style="color:#ae81ff">1</span>       Replicas: <span style="color:#ae81ff">1</span>     Isr: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        Topic: first_topic      Partition: <span style="color:#ae81ff">1</span>    Leader: <span style="color:#ae81ff">1</span>       Replicas: <span style="color:#ae81ff">1</span>     Isr: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        Topic: first_topic      Partition: <span style="color:#ae81ff">2</span>    Leader: <span style="color:#ae81ff">1</span>       Replicas: <span style="color:#ae81ff">1</span>     Isr: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<h4 id="delete-a-topic">Delete a topic</h4>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-topics --bootstrap-server localhost:9092 --list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>first-topic
</span></span><span style="display:flex;"><span>first_topic
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$ kafka-topics --bootstrap-server localhost:9092 --delete --topic first-topic
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$ kafka-topics --bootstrap-server localhost:9092 --list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>first_topic
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<h3 id="kafka-console-producer">Kafka console producer</h3>
<h4 id="create-messages">Create messages</h4>
<p>Creating 4 messages using Kafka Broker using the <code>kafka-console-producer</code> command.  The <code>CTRL-C</code> command will make the <code>kafka-console-producer</code> command to stop.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-console-producer --broker-list localhost:9092 --topic first_topic
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt;message1
</span></span><span style="display:flex;"><span>&gt;message2
</span></span><span style="display:flex;"><span>&gt;message3
</span></span><span style="display:flex;"><span>&gt;message4
</span></span><span style="display:flex;"><span>&gt;^C
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<h4 id="create-messages-in-a-non-existing-topic">Create messages in a non-existing topic</h4>
<p>It is possible to create a new topic on-the-fly when adding but it is not recommended since the default values for both <code>PartitionCount</code> and <code>ReplicationFactor</code> are set to <code>1</code>. Best practices require more partitions and replications.</p>
<p>Default replication value can be changed from <code>/etc/kafka/server.properties</code> value <code>num.partitions</code>, default is 1.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-console-producer --broker-list localhost:9092 --topic new_topic
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt;This is a message to a new topic
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2022-06-02 18:56:53,185<span style="color:#f92672">]</span> WARN <span style="color:#f92672">[</span>Producer clientId<span style="color:#f92672">=</span>console-producer<span style="color:#f92672">]</span> Error <span style="color:#66d9ef">while</span> fetching metadata with correlation id <span style="color:#ae81ff">3</span> : <span style="color:#f92672">{</span>new_topic<span style="color:#f92672">=</span>LEADER_NOT_AVAILABLE<span style="color:#f92672">}</span> <span style="color:#f92672">(</span>org.apache.kafka.clients.NetworkClient<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>&gt;another message
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$ kafka-topics --bootstrap-server localhost:9092 --list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>first_topic
</span></span><span style="display:flex;"><span>new_topic
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$ kafka-topics --bootstrap-server localhost:9092 --topic new_topic --describe
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Topic: new_topic        TopicId: FuC1JLRETNCrgUWaEPZCOg PartitionCount: <span style="color:#ae81ff">1</span>       ReplicationFactor: <span style="color:#ae81ff">1</span>    Configs:
</span></span><span style="display:flex;"><span>        Topic: new_topic        Partition: <span style="color:#ae81ff">0</span>    Leader: <span style="color:#ae81ff">1</span>       Replicas: <span style="color:#ae81ff">1</span>     Isr: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<h4 id="change-the-producer-property">Change the producer-property</h4>
<p>Changing the <code>acks</code> property.  Refer to <a href="/notes/apache-kafka/index.html#producers">producer</a> above sections for more information about <code>acks=all</code> property.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-console-producer --broker-list localhost:9092 --topic first_topic --producer-property acks<span style="color:#f92672">=</span>all
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt;acks message1
</span></span><span style="display:flex;"><span>&gt;^C
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<h3 id="kafka-console-consumer">Kafka console consumer</h3>
<h4 id="consuming-messages-from-a-topic">Consuming messages from a topic</h4>
<p>The <code>kafka-console-consumer</code> won&rsquo;t consume topic messages from <code>offset=0</code> by default to avoid consuming millions of existing message.  It will consume the upcomming messages only (from now on).  To get all messages from offest:0, the <code>--from-beginning</code> option must be specified.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-console-consumer --bootstrap-server localhost:9092 --topic first_topic --from-beginning
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>message2
</span></span><span style="display:flex;"><span>acks message1
</span></span><span style="display:flex;"><span>message3
</span></span><span style="display:flex;"><span>message1
</span></span><span style="display:flex;"><span>message4</span></span></code></pre></div>
<p>The order isn&rsquo;t garanteed when the number of topic partitions is greater than 1, as explained in <a href="/notes/apache-kafka/index.html#topics-partitions-and-offsets">Topics, partitions and offsets</a> section.</p>
<h4 id="consuming-messages-from-a-topic-with-groups">Consuming messages from a topic with groups</h4>
<p>The <code>--group</code> define a group of kafka consumers that will share the consumption load for one given topic.</p>
<p>The <code>kafka-console-producer</code> example:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-console-producer --broker-list localhost:9092 --topic first_topic
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt;patate
</span></span><span style="display:flex;"><span>&gt;carotte
</span></span><span style="display:flex;"><span>&gt;pomme
</span></span><span style="display:flex;"><span>&gt;orange
</span></span><span style="display:flex;"><span>&gt;</span></span></code></pre></div>
<p>The first <code>kafka-console-consumer</code> example:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-console-consumer --bootstrap-server localhost:9092 --topic first_topic --group my-group
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>carotte
</span></span><span style="display:flex;"><span>orange</span></span></code></pre></div>
<p>The second <code>kafka-console-consumer</code> example:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-console-consumer --bootstrap-server localhost:9092 --topic first_topic --group my-group
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>patate
</span></span><span style="display:flex;"><span>pomme</span></span></code></pre></div>
<h4 id="consumer-groups-command">Consumer groups command</h4>
<p>Get all the available consumer groups:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-consumer-groups --bootstrap-server localhost:9092 --list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>my-group
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<p>Get consumer group information:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-consumer-groups --bootstrap-server localhost:9092 --describe --group my-group
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                           HOST            CLIENT-ID
</span></span><span style="display:flex;"><span>my-group        first_topic     <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">3</span>               <span style="color:#ae81ff">3</span>               <span style="color:#ae81ff">0</span>               console-consumer-13be95b9-8704-4471-8211-2660c5ab59b1 /172.19.0.3     console-consumer
</span></span><span style="display:flex;"><span>my-group        first_topic     <span style="color:#ae81ff">1</span>          <span style="color:#ae81ff">2</span>               <span style="color:#ae81ff">2</span>               <span style="color:#ae81ff">0</span>               console-consumer-13be95b9-8704-4471-8211-2660c5ab59b1 /172.19.0.3     console-consumer
</span></span><span style="display:flex;"><span>my-group        first_topic     <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">4</span>               <span style="color:#ae81ff">4</span>               <span style="color:#ae81ff">0</span>               console-consumer-13be95b9-8704-4471-8211-2660c5ab59b1 /172.19.0.3     console-consumer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<h4 id="consumer-groups-reseting-offsets">Consumer groups: reseting offsets</h4>
<p>All messages are currently consumed: <code>current-offsets=log-end-offsets</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-consumer-groups --bootstrap-server localhost:9092 --describe --group my-group
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                           HOST            CLIENT-ID
</span></span><span style="display:flex;"><span>my-group        first_topic     <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">3</span>               <span style="color:#ae81ff">3</span>               <span style="color:#ae81ff">0</span>               console-consumer-13be95b9-8704-4471-8211-2660c5ab59b1 /172.19.0.3     console-consumer
</span></span><span style="display:flex;"><span>my-group        first_topic     <span style="color:#ae81ff">1</span>          <span style="color:#ae81ff">2</span>               <span style="color:#ae81ff">2</span>               <span style="color:#ae81ff">0</span>               console-consumer-13be95b9-8704-4471-8211-2660c5ab59b1 /172.19.0.3     console-consumer
</span></span><span style="display:flex;"><span>my-group        first_topic     <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">4</span>               <span style="color:#ae81ff">4</span>               <span style="color:#ae81ff">0</span>               console-consumer-13be95b9-8704-4471-8211-2660c5ab59b1 /172.19.0.3     console-consumer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<p>Reseting the <code>current-offsets</code> to <code>0</code> using <code>--to-earliest</code> option:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-consumer-groups --bootstrap-server localhost:9092 --group my-group --reset-offsets --to-earliest --execute --topic first_topic
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GROUP                          TOPIC                          PARTITION  NEW-OFFSET
</span></span><span style="display:flex;"><span>my-group                       first_topic                    <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>my-group                       first_topic                    <span style="color:#ae81ff">1</span>          <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>my-group                       first_topic                    <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<p>Verify the group offsets is not <code>0</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-consumer-groups --bootstrap-server localhost:9092 --describe --group my-group
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Consumer group <span style="color:#e6db74">&#39;my-group&#39;</span> has no active members.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
</span></span><span style="display:flex;"><span>my-group        first_topic     <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">3</span>               <span style="color:#ae81ff">3</span>               -               -               -
</span></span><span style="display:flex;"><span>my-group        first_topic     <span style="color:#ae81ff">1</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">2</span>               <span style="color:#ae81ff">2</span>               -               -               -
</span></span><span style="display:flex;"><span>my-group        first_topic     <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">4</span>               <span style="color:#ae81ff">4</span>               -               -               -
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<p>Shift the offset by <code>1</code> using <code>--shift-by</code> option:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kafka-consumer-groups --bootstrap-server localhost:9092 --group my-group --reset-offsets --shift-by <span style="color:#ae81ff">1</span> --
</span></span><span style="display:flex;"><span>execute --topic first_topic
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GROUP                          TOPIC                          PARTITION  NEW-OFFSET
</span></span><span style="display:flex;"><span>my-group                       first_topic                    <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>my-group                       first_topic                    <span style="color:#ae81ff">1</span>          <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>my-group                       first_topic                    <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<p>Available <code>--reset-offsets</code> options are :</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>--to-datetime
</span></span><span style="display:flex;"><span>--by-period
</span></span><span style="display:flex;"><span>--to-earliest
</span></span><span style="display:flex;"><span>--to-latest
</span></span><span style="display:flex;"><span>--shift-by
</span></span><span style="display:flex;"><span>--from-file
</span></span><span style="display:flex;"><span>--to-current</span></span></code></pre></div>
<h3 id="kafka-client-with-java">Kafka-Client with Java</h3>
<p>Use <a href="https://kafka.apache.org/documentation/" rel="external" target="_blank">Kafka Documentation</a> as much as possible.</p>
<h4 id="create-java-project">Create Java project</h4>
<p>Using IntelliJ:</p>
<ol>
<li>create a project</li>
<li>search for <code>kafka-client</code> in <a href="https://mvnrepository.com/artifact/org.apache.kafka/kafka-clients" rel="external" target="_blank">https://mvnrepository.com/</a></li>
<li>select the desired version (i.e., the following will use 3.2.0)</li>
<li>copy the <code>Gradle</code> implementation information in the <code>dependencies</code> section of the <code>build.gradle</code> file</li>
<li>download the dependencies using IntelliJ <code>Gradle</code> window -&gt; <code>Reload...</code> button</li>
<li>repeat same steps for <code>slf4j-simple</code> package and set scope to <code>implementation</code> instead of <code>testImplementation</code></li>
<li>create a new package, e.g., <code>com.github.alainbouchard.kafka-demo.demo1</code></li>
</ol>
<h4 id="create-a-simple-producer">Create a simple producer</h4>
<p>The following are needed when creating a producer:</p>
<ul>
<li>kafka <code>producer</code> properties (or <code>Properties</code> object)</li>
<li>kafka <code>producter</code> creation</li>
<li>Send data (verification)</li>
<li>Close the <code>producer</code></li>
</ul>
<p>Reference for <a href="https://kafka.apache.org/documentation/#producerconfigs" rel="external" target="_blank">Kafka Producer Properties</a>.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">KafkaProducerDemo</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        Properties properties <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Set Producer Properties</span>
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">BOOTSTRAP_SERVERS_CONFIG</span>, <span style="color:#e6db74">&#34;127.0.0.1:29092&#34;</span>);
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">KEY_SERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">VALUE_SERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Create Kafka Producer</span>
</span></span><span style="display:flex;"><span>        KafkaProducer<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> producer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> KafkaProducer<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span>(properties);
</span></span><span style="display:flex;"><span>        ProducerRecord<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> record <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ProducerRecord<span style="color:#f92672">&lt;&gt;</span>(<span style="color:#e6db74">&#34;first_topic&#34;</span>, <span style="color:#e6db74">&#34;hello world from Java!&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Send data</span>
</span></span><span style="display:flex;"><span>        producer.<span style="color:#a6e22e">send</span>(record); <span style="color:#75715e">// asynchronous, need to flush data</span>
</span></span><span style="display:flex;"><span>        producer.<span style="color:#a6e22e">flush</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Tear down Producer</span>
</span></span><span style="display:flex;"><span>        producer.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h4 id="create-a-producer-with-a-callback">Create a producer with a callback</h4>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">KafkaProducerDemoWithCallback</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        Logger logger <span style="color:#f92672">=</span> LoggerFactory.<span style="color:#a6e22e">getLogger</span>(KafkaProducerDemoWithCallback.<span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Properties properties <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Set Producer Properties</span>
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">BOOTSTRAP_SERVERS_CONFIG</span>, <span style="color:#e6db74">&#34;127.0.0.1:29092&#34;</span>);
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">KEY_SERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">VALUE_SERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Create Kafka Producer</span>
</span></span><span style="display:flex;"><span>        KafkaProducer<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> producer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> KafkaProducer<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span>(properties);
</span></span><span style="display:flex;"><span>        ProducerRecord<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> record <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ProducerRecord<span style="color:#f92672">&lt;&gt;</span>(<span style="color:#e6db74">&#34;first_topic&#34;</span>, <span style="color:#e6db74">&#34;hello world from Java!&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Send data</span>
</span></span><span style="display:flex;"><span>        producer.<span style="color:#a6e22e">send</span>(record, <span style="color:#66d9ef">new</span> Callback() {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onCompletion</span>(RecordMetadata metadata, Exception exception) {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// execute everytime a message is sent OR an exception is thrown.</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (exception <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// successfully sent message</span>
</span></span><span style="display:flex;"><span>                    logger.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Received metadata - Topic: &#34;</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">+</span> metadata.<span style="color:#a6e22e">topic</span>() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Partition: &#34;</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">+</span> metadata.<span style="color:#a6e22e">partition</span>() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Offset: &#34;</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">+</span> metadata.<span style="color:#a6e22e">offset</span>() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Timestamp: &#34;</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">+</span> metadata.<span style="color:#a6e22e">timestamp</span>());
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    logger.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;Error while producer sent a message&#34;</span>, exception);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }); <span style="color:#75715e">// asynchronous, need to flush data</span>
</span></span><span style="display:flex;"><span>        producer.<span style="color:#a6e22e">flush</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Tear down Producer</span>
</span></span><span style="display:flex;"><span>        producer.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h4 id="create-a-simple-consumer">Create a simple consumer</h4>
<p>The following are needed when creating a <code>consumer</code>:</p>
<ul>
<li>kafka <code>consumer</code> properties (or <code>Properties</code> object)</li>
<li>kafka <code>consumer</code> creation</li>
<li>poll data in a loop</li>
</ul>
<p>Reference for <a href="https://kafka.apache.org/documentation/#consumerconfigs" rel="external" target="_blank">Kafka Consumer Properties</a>.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">KafkaConsumerDemo</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        Logger logger <span style="color:#f92672">=</span> LoggerFactory.<span style="color:#a6e22e">getLogger</span>(KafkaConsumerDemo.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Configure the consumer</span>
</span></span><span style="display:flex;"><span>        Properties properties <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties();
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">BOOTSTRAP_SERVERS_CONFIG</span>, <span style="color:#e6db74">&#34;localhost:29092&#34;</span>);
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">KEY_DESERIALIZER_CLASS_CONFIG</span>, StringDeserializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">VALUE_DESERIALIZER_CLASS_CONFIG</span>, StringDeserializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">GROUP_ID_CONFIG</span>, <span style="color:#e6db74">&#34;my_group&#34;</span>);
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">AUTO_OFFSET_RESET_CONFIG</span>, <span style="color:#e6db74">&#34;earliest&#34;</span>); <span style="color:#75715e">// Possible values : none, earliest, latest</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Create consumer</span>
</span></span><span style="display:flex;"><span>        KafkaConsumer<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> consumer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> KafkaConsumer<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span>(properties);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Subscribe the consumer to the Topic or Topics</span>
</span></span><span style="display:flex;"><span>        consumer.<span style="color:#a6e22e">subscribe</span>(Arrays.<span style="color:#a6e22e">asList</span>(<span style="color:#e6db74">&#34;first_topic&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Poll for new data</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span>(<span style="color:#66d9ef">true</span>) { <span style="color:#75715e">// Avoid in production - demo purpose only.</span>
</span></span><span style="display:flex;"><span>            ConsumerRecords<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> records <span style="color:#f92672">=</span> consumer.<span style="color:#a6e22e">poll</span>(Duration.<span style="color:#a6e22e">ofMillis</span>(100));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            records.<span style="color:#a6e22e">forEach</span>(r <span style="color:#f92672">-&gt;</span> logger.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Key: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">key</span>()
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Value: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">value</span>()
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Partition: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">partition</span>()
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Offset: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">offset</span>()
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Timestamp: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">timestamp</span>()));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h4 id="create-a-consumer-in-a-thread">Create a consumer in a thread</h4>
<p>Note: It is only working if the application does stop gracefully.  A Break/Kill signal won&rsquo;t trigger the shutdown properly.  IntelliJ don&rsquo;t have the <code>exit</code> button on Windows.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">KafkaConsumerWithThreadsDemo</span> {
</span></span><span style="display:flex;"><span>    Logger logger <span style="color:#f92672">=</span> LoggerFactory.<span style="color:#a6e22e">getLogger</span>(KafkaConsumerWithThreadsDemo.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">KafkaConsumerWithThreadsDemo</span>() { }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>        String bootstrapServer <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;localhost:29092&#34;</span>;
</span></span><span style="display:flex;"><span>        String groupId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;my_group&#34;</span>;
</span></span><span style="display:flex;"><span>        String topic <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;first_topic&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Latch for dealing with multiple threads;</span>
</span></span><span style="display:flex;"><span>        CountDownLatch latch <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CountDownLatch(1);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Create Consumer Runnable;</span>
</span></span><span style="display:flex;"><span>        Runnable consumerRunnable <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConsumerRunnable(bootstrapServer, groupId, topic, latch);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Starting Consumer Runnable Thread;</span>
</span></span><span style="display:flex;"><span>        Thread thread <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread(consumerRunnable);
</span></span><span style="display:flex;"><span>        thread.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Add a shutdown hook;</span>
</span></span><span style="display:flex;"><span>        Runtime.<span style="color:#a6e22e">getRuntime</span>().<span style="color:#a6e22e">addShutdownHook</span>(<span style="color:#66d9ef">new</span> Thread( () <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            logger.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Received a shutdown hook...&#34;</span>);
</span></span><span style="display:flex;"><span>            ((ConsumerRunnable) consumerRunnable).<span style="color:#a6e22e">shutdown</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                latch.<span style="color:#a6e22e">await</span>();
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            logger.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Consumer application has exited...&#34;</span>);
</span></span><span style="display:flex;"><span>        }));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            latch.<span style="color:#a6e22e">await</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>            logger.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;Consumer application got interrupted&#34;</span>, e);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            logger.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Consumer application is closing...&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConsumerRunnable</span> <span style="color:#66d9ef">implements</span> Runnable {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> CountDownLatch latch;
</span></span><span style="display:flex;"><span>        KafkaConsumer<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> consumer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ConsumerRunnable</span>(String bootstrapServer, String groupId, String topic, CountDownLatch latch) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">latch</span> <span style="color:#f92672">=</span> latch;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Configure the consumer</span>
</span></span><span style="display:flex;"><span>            Properties properties <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties();
</span></span><span style="display:flex;"><span>            properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">BOOTSTRAP_SERVERS_CONFIG</span>, bootstrapServer);
</span></span><span style="display:flex;"><span>            properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">KEY_DESERIALIZER_CLASS_CONFIG</span>, StringDeserializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>            properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">VALUE_DESERIALIZER_CLASS_CONFIG</span>, StringDeserializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>            properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">GROUP_ID_CONFIG</span>, groupId);
</span></span><span style="display:flex;"><span>            properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">AUTO_OFFSET_RESET_CONFIG</span>, <span style="color:#e6db74">&#34;earliest&#34;</span>); <span style="color:#75715e">// Possible values : none, earliest, latest</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Create consumer</span>
</span></span><span style="display:flex;"><span>            consumer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> KafkaConsumer<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span>(properties);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Subscribe the consumer to the Topic or Topics</span>
</span></span><span style="display:flex;"><span>            consumer.<span style="color:#a6e22e">subscribe</span>(Arrays.<span style="color:#a6e22e">asList</span>(topic));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Poll for new data</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) { <span style="color:#75715e">// Avoid in production - demo purpose only.</span>
</span></span><span style="display:flex;"><span>                    ConsumerRecords<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> records <span style="color:#f92672">=</span> consumer.<span style="color:#a6e22e">poll</span>(Duration.<span style="color:#a6e22e">ofMillis</span>(100));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    records.<span style="color:#a6e22e">forEach</span>(r <span style="color:#f92672">-&gt;</span> logger.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Key: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">key</span>()
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Value: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">value</span>()
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Partition: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">partition</span>()
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Offset: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">offset</span>()
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Timestamp: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">timestamp</span>()));
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> ( WakeupException exception) {
</span></span><span style="display:flex;"><span>                logger.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Received shutdown signal...&#34;</span>);
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                consumer.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                latch.<span style="color:#a6e22e">countDown</span>(); <span style="color:#75715e">// telling caller code that this thread is done.</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">shutdown</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// to interrupt the consumer.poll() method</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// and will make consumer.poll() to throw an exception WakeupException</span>
</span></span><span style="display:flex;"><span>            consumer.<span style="color:#a6e22e">wakeup</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> KafkaConsumerWithThreadsDemo().<span style="color:#a6e22e">run</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h4 id="assign-and-seek-consumer">Assign and seek consumer</h4>
<p>The Assign and Seek is mostly used to replay data or fetch a specific message.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">KafkaConsumerWithAssignAndSeekDemo</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        Logger logger <span style="color:#f92672">=</span> LoggerFactory.<span style="color:#a6e22e">getLogger</span>(KafkaConsumerWithAssignAndSeekDemo.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Configure the consumer</span>
</span></span><span style="display:flex;"><span>        Properties properties <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties();
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">BOOTSTRAP_SERVERS_CONFIG</span>, <span style="color:#e6db74">&#34;localhost:29092&#34;</span>);
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">KEY_DESERIALIZER_CLASS_CONFIG</span>, StringDeserializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">VALUE_DESERIALIZER_CLASS_CONFIG</span>, StringDeserializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// properties.setProperty(ConsumerConfig.GROUP_ID_CONFIG, &#34;my_group&#34;); No needs for group with assign and seek...</span>
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">AUTO_OFFSET_RESET_CONFIG</span>, <span style="color:#e6db74">&#34;earliest&#34;</span>); <span style="color:#75715e">// Possible values : none, earliest, latest</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Create consumer</span>
</span></span><span style="display:flex;"><span>        KafkaConsumer<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> consumer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> KafkaConsumer<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span>(properties);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// The Assign and Seek is mostly used to replay data or fetch a specific message.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Assign</span>
</span></span><span style="display:flex;"><span>        TopicPartition partition <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TopicPartition(<span style="color:#e6db74">&#34;first_topic&#34;</span>, 0);
</span></span><span style="display:flex;"><span>        consumer.<span style="color:#a6e22e">assign</span>(Arrays.<span style="color:#a6e22e">asList</span>(partition));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Seek</span>
</span></span><span style="display:flex;"><span>        consumer.<span style="color:#a6e22e">seek</span>(partition, 1L);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Poll for new data</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span>(<span style="color:#66d9ef">true</span>) { <span style="color:#75715e">// Avoid in production - demo purpose only.</span>
</span></span><span style="display:flex;"><span>            ConsumerRecords<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> records <span style="color:#f92672">=</span> consumer.<span style="color:#a6e22e">poll</span>(Duration.<span style="color:#a6e22e">ofMillis</span>(100));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            records.<span style="color:#a6e22e">forEach</span>(r <span style="color:#f92672">-&gt;</span> logger.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Key: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">key</span>()
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Value: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">value</span>()
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Partition: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">partition</span>()
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Offset: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">offset</span>()
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Timestamp: &#34;</span> <span style="color:#f92672">+</span> r.<span style="color:#a6e22e">timestamp</span>()));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h4 id="kafka-bidirectional-compatibility">Kafka Bidirectional Compatibility</h4>
<p>As Kafka 0.10.2 (July 2017), the client and brokers hava a vapability called bi-directional compatibility (because API calls are nov versioned).</p>
<p>It means that <strong>the latest client library version should always be used</strong> as documented in the confluent documentation <a href="https://www.confluent.io/blog/upgrading-apache-kafka-clients-just-got-easier/" rel="external" target="_blank">Upgrading Apache Kafka Clients Just Got Easier</a></p>
<h4 id="creating-a-producer-for-twitter-messages">Creating a Producer for Twitter messages</h4>
<p>Needed packages:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>dependencies <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    implementation group: <span style="color:#e6db74">&#39;com.twitter&#39;</span><span style="color:#f92672">,</span> name: <span style="color:#e6db74">&#39;twitter-api-java-sdk&#39;</span><span style="color:#f92672">,</span> version: <span style="color:#e6db74">&#39;1.2.4&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div>
<p>Creating the topic:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kafka-topics --bootstrap-server localhost:9092 --create --topic twitter_tweets --partitions <span style="color:#ae81ff">6</span> --replication-factor <span style="color:#ae81ff">1</span></span></span></code></pre></div>
<p>Adding a <code>TwitterKafkaProducerInterface</code> Interface:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.github.alainbouchard.kafka_demo.demo2;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">TwitterKafkaProducerInterface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">send</span>(String topic, String message);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Implementing the interface with <code>TwitterKafkaProducer</code> Class:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TwitterKafkaProducer</span> <span style="color:#66d9ef">implements</span> TwitterKafkaProducerInterface {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Logger logger <span style="color:#f92672">=</span> LoggerFactory.<span style="color:#a6e22e">getLogger</span>(TwitterKafkaProducer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> KafkaProducer<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> producer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">TwitterKafkaProducer</span>() {
</span></span><span style="display:flex;"><span>        Properties properties <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Set Producer Properties</span>
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">BOOTSTRAP_SERVERS_CONFIG</span>, <span style="color:#e6db74">&#34;127.0.0.1:29092&#34;</span>);
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">KEY_SERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">VALUE_SERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Create Kafka Producer</span>
</span></span><span style="display:flex;"><span>        producer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> KafkaProducer<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span>(properties);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Create topic:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// kafka-topics --bootstrap-server localhost:9092 --create --topic twitter_tweets --partitions 6 --replication-factor 1</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Logger <span style="color:#a6e22e">getLogger</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> logger;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">send</span>(String topic, String message) {
</span></span><span style="display:flex;"><span>        ProducerRecord producerRecord <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ProducerRecord<span style="color:#f92672">&lt;&gt;</span>(topic, <span style="color:#66d9ef">null</span>, message);
</span></span><span style="display:flex;"><span>        producer.<span style="color:#a6e22e">send</span>(producerRecord, <span style="color:#66d9ef">new</span> Callback() {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onCompletion</span>(RecordMetadata metadata, Exception exception) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (exception <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                    getLogger().<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;Could not send the message to the producer.&#34;</span>, exception);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Adding the <code>TwitterListerner</code> Class:</p>
<p>Some TwitterApi v2 SDK methods have issues at the moment that this document is written.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TwitterListener</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/***
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Ref:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *    https://developer.axonivy.com/api-browser?url=/market-cache/twitter/twitter-connector-product/9.3.0/openapi.json#/Tweets/addOrDeleteRules
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *    https://github.com/twitterdev/twitter-api-java-sdk/tree/d0d6a8ce8db16faf4e3e1841c3a43bd5a56aa069
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *    https://developer.twitter.com/en/docs/twitter-api
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Logger logger <span style="color:#f92672">=</span> LoggerFactory.<span style="color:#a6e22e">getLogger</span>(TwitterListener.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// API V2 uses BEARER token.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TODO: Use environment variable for BEARER_TOKEN.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> String BEARER_TOKEN <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> TwitterApi twitterApi;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> TwitterKafkaProducerInterface twitterKafkaProducer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Function<span style="color:#f92672">&lt;</span>List<span style="color:#f92672">&lt;</span>Rule<span style="color:#f92672">&gt;</span>, List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;&gt;</span> GetIdsFromRules <span style="color:#f92672">=</span> r <span style="color:#f92672">-&gt;</span> r.<span style="color:#a6e22e">stream</span>().<span style="color:#a6e22e">map</span>(Rule::getId).<span style="color:#a6e22e">collect</span>(Collectors.<span style="color:#a6e22e">toList</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">TwitterListener</span>() {
</span></span><span style="display:flex;"><span>        twitterApi <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TwitterApi();
</span></span><span style="display:flex;"><span>        TwitterCredentialsBearer credentials <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TwitterCredentialsBearer(BEARER_TOKEN);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        twitterApi.<span style="color:#a6e22e">setTwitterCredentials</span>(credentials);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Logger <span style="color:#a6e22e">getLogger</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> logger;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> TwitterApi <span style="color:#a6e22e">getTwitterApi</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> twitterApi;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setTwitterKafkaProducer</span>(TwitterKafkaProducerInterface twitterKafkaProducer) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">twitterKafkaProducer</span> <span style="color:#f92672">=</span> twitterKafkaProducer;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">logApiExceptionToString</span>(String description, ApiException e) {
</span></span><span style="display:flex;"><span>        String text <span style="color:#f92672">=</span> description
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Status code: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getCode</span>()
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Reason: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getResponseBody</span>()
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Response headers: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getResponseHeaders</span>();
</span></span><span style="display:flex;"><span>        getLogger().<span style="color:#a6e22e">error</span>(text, e);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Rule<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">addRule</span>(String value, String tag, <span style="color:#66d9ef">boolean</span> dryRun) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Create rule</span>
</span></span><span style="display:flex;"><span>        RuleNoId ruleNoId <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RuleNoId();
</span></span><span style="display:flex;"><span>        ruleNoId.<span style="color:#a6e22e">setValue</span>(value);
</span></span><span style="display:flex;"><span>        ruleNoId.<span style="color:#a6e22e">setTag</span>(tag);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Add rule to list of rules</span>
</span></span><span style="display:flex;"><span>        List<span style="color:#f92672">&lt;</span>RuleNoId<span style="color:#f92672">&gt;</span> ruleNoIds <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        ruleNoIds.<span style="color:#a6e22e">add</span>(ruleNoId);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Add the list of rules to the request</span>
</span></span><span style="display:flex;"><span>        AddRulesRequest addRulesRequest <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> AddRulesRequest();
</span></span><span style="display:flex;"><span>        addRulesRequest.<span style="color:#a6e22e">add</span>(ruleNoIds);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        AddOrDeleteRulesRequest addOrDeleteRulesRequest <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> AddOrDeleteRulesRequest();
</span></span><span style="display:flex;"><span>        addOrDeleteRulesRequest.<span style="color:#a6e22e">setActualInstance</span>(addRulesRequest);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        List<span style="color:#f92672">&lt;</span>Rule<span style="color:#f92672">&gt;</span> rules <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            AddOrDeleteRulesResponse result <span style="color:#f92672">=</span> getTwitterApi().<span style="color:#a6e22e">tweets</span>().<span style="color:#a6e22e">addOrDeleteRules</span>(addOrDeleteRulesRequest, dryRun);
</span></span><span style="display:flex;"><span>            getLogger().<span style="color:#a6e22e">info</span>(result.<span style="color:#a6e22e">toString</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            rules <span style="color:#f92672">=</span> result.<span style="color:#a6e22e">getData</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (ApiException e) {
</span></span><span style="display:flex;"><span>            logApiExceptionToString(<span style="color:#e6db74">&#34;Exception when calling TweetsApi#addOrDeleteRules&#34;</span>, e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> rules;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> AddOrDeleteRulesResponse <span style="color:#a6e22e">deleteRules</span>(List<span style="color:#f92672">&lt;</span>Rule<span style="color:#f92672">&gt;</span> rules, <span style="color:#66d9ef">boolean</span> dryRun) {
</span></span><span style="display:flex;"><span>        DeleteRulesRequestDelete deleteRulesRequestDelete <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DeleteRulesRequestDelete();
</span></span><span style="display:flex;"><span>        deleteRulesRequestDelete.<span style="color:#a6e22e">ids</span>(GetIdsFromRules.<span style="color:#a6e22e">apply</span>(rules));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        DeleteRulesRequest deleteRulesRequest <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DeleteRulesRequest();
</span></span><span style="display:flex;"><span>        deleteRulesRequest.<span style="color:#a6e22e">setDelete</span>(deleteRulesRequestDelete);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        AddOrDeleteRulesRequest addOrDeleteRulesRequestForDelete <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> AddOrDeleteRulesRequest();
</span></span><span style="display:flex;"><span>        addOrDeleteRulesRequestForDelete.<span style="color:#a6e22e">setActualInstance</span>(deleteRulesRequest);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        AddOrDeleteRulesResponse result <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getTwitterApi</span>().<span style="color:#a6e22e">tweets</span>().<span style="color:#a6e22e">addOrDeleteRules</span>(addOrDeleteRulesRequestForDelete, dryRun);
</span></span><span style="display:flex;"><span>            getLogger().<span style="color:#a6e22e">info</span>(result.<span style="color:#a6e22e">toString</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (ApiException e) {
</span></span><span style="display:flex;"><span>            logApiExceptionToString(<span style="color:#e6db74">&#34;Exception when calling TweetsApi#addOrDeleteRules&#34;</span>, e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> GetRulesResponse <span style="color:#a6e22e">getRules</span>(String paginationToken, List<span style="color:#f92672">&lt;</span>Rule<span style="color:#f92672">&gt;</span> rules, Integer maxResults) {
</span></span><span style="display:flex;"><span>        List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> ruleIds <span style="color:#f92672">=</span> rules <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">?</span> GetIdsFromRules.<span style="color:#a6e22e">apply</span>(rules) : <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        GetRulesResponse result <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">=</span> getTwitterApi().<span style="color:#a6e22e">tweets</span>().<span style="color:#a6e22e">getRules</span>(ruleIds, maxResults, paginationToken);
</span></span><span style="display:flex;"><span>            getLogger().<span style="color:#a6e22e">info</span>(result.<span style="color:#a6e22e">toString</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (ApiException e) {
</span></span><span style="display:flex;"><span>            logApiExceptionToString(<span style="color:#e6db74">&#34;Exception when calling TweetsApi#getRules&#34;</span>, e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> GetRulesResponse <span style="color:#a6e22e">getRules</span>(String paginationToken, List<span style="color:#f92672">&lt;</span>Rule<span style="color:#f92672">&gt;</span> rules) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getRules</span>(paginationToken, rules, 1000);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> GetRulesResponse <span style="color:#a6e22e">getRules</span>(String paginationToken) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getRules</span>(paginationToken, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">searchStream</span>() {
</span></span><span style="display:flex;"><span>        Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> expansions <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet<span style="color:#f92672">&lt;&gt;</span>(Arrays.<span style="color:#a6e22e">asList</span>());
</span></span><span style="display:flex;"><span>        Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> tweetFields <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        tweetFields.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#34;id&#34;</span>);
</span></span><span style="display:flex;"><span>        tweetFields.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#34;author_id&#34;</span>);
</span></span><span style="display:flex;"><span>        tweetFields.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#34;created_at&#34;</span>);
</span></span><span style="display:flex;"><span>        tweetFields.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#34;text&#34;</span>);
</span></span><span style="display:flex;"><span>        Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> userFields <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet<span style="color:#f92672">&lt;&gt;</span>(Arrays.<span style="color:#a6e22e">asList</span>());
</span></span><span style="display:flex;"><span>        Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> mediaFields <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet<span style="color:#f92672">&lt;&gt;</span>(Arrays.<span style="color:#a6e22e">asList</span>());
</span></span><span style="display:flex;"><span>        Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> placeFields <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet<span style="color:#f92672">&lt;&gt;</span>(Arrays.<span style="color:#a6e22e">asList</span>());
</span></span><span style="display:flex;"><span>        Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> pollFields <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet<span style="color:#f92672">&lt;&gt;</span>(Arrays.<span style="color:#a6e22e">asList</span>());
</span></span><span style="display:flex;"><span>        Integer backfillMinutes <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;  <span style="color:#75715e">// There is a bug in the Twitter API v2 where any specified value will cause an error.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        InputStream result <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">=</span> getTwitterApi().<span style="color:#a6e22e">tweets</span>().<span style="color:#a6e22e">searchStream</span>(expansions, tweetFields, userFields, mediaFields, placeFields, pollFields, backfillMinutes);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                JSON json <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JSON();
</span></span><span style="display:flex;"><span>                Type localVarReturnType <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TypeToken<span style="color:#f92672">&lt;</span>FilteredStreamingTweet<span style="color:#f92672">&gt;</span>(){}.<span style="color:#a6e22e">getType</span>();
</span></span><span style="display:flex;"><span>                BufferedReader reader <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader(<span style="color:#66d9ef">new</span> InputStreamReader(result));
</span></span><span style="display:flex;"><span>                String line <span style="color:#f92672">=</span> reader.<span style="color:#a6e22e">readLine</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">while</span> (line <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (line.<span style="color:#a6e22e">isEmpty</span>()) {
</span></span><span style="display:flex;"><span>                        getLogger().<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;==&gt; Empty line&#34;</span>);
</span></span><span style="display:flex;"><span>                        line <span style="color:#f92672">=</span> reader.<span style="color:#a6e22e">readLine</span>();
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    Object jsonObject <span style="color:#f92672">=</span> json.<span style="color:#a6e22e">getGson</span>().<span style="color:#a6e22e">fromJson</span>(line, localVarReturnType);
</span></span><span style="display:flex;"><span>                    String message <span style="color:#f92672">=</span> jsonObject <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> jsonObject.<span style="color:#a6e22e">toString</span>() : <span style="color:#e6db74">&#34;Null object&#34;</span>;
</span></span><span style="display:flex;"><span>                    getLogger().<span style="color:#a6e22e">info</span>(message);
</span></span><span style="display:flex;"><span>                    twitterKafkaProducer.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#34;twitter_tweets&#34;</span>, message);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    line <span style="color:#f92672">=</span> reader.<span style="color:#a6e22e">readLine</span>();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (ApiException e) {
</span></span><span style="display:flex;"><span>            logApiExceptionToString(<span style="color:#e6db74">&#34;Exception when calling TweetsApi#searchStream&#34;</span>, e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        TwitterListener twitterListener <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TwitterListener();
</span></span><span style="display:flex;"><span>        twitterListener.<span style="color:#a6e22e">setTwitterKafkaProducer</span>(<span style="color:#66d9ef">new</span> TwitterKafkaProducer());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">boolean</span> dryRun <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Delete all existing Rules;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            GetRulesResponse rulesResponse <span style="color:#f92672">=</span> twitterListener.<span style="color:#a6e22e">getRules</span>(<span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>            AddOrDeleteRulesResponse result <span style="color:#f92672">=</span> twitterListener.<span style="color:#a6e22e">deleteRules</span>(rulesResponse.<span style="color:#a6e22e">getData</span>(), dryRun);
</span></span><span style="display:flex;"><span>            twitterListener.<span style="color:#a6e22e">getLogger</span>().<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Deleted rules: &#34;</span> <span style="color:#f92672">+</span> twitterListener.<span style="color:#a6e22e">GetIdsFromRules</span>.<span style="color:#a6e22e">apply</span>(result.<span style="color:#a6e22e">getData</span>()));
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            twitterListener.<span style="color:#a6e22e">getLogger</span>().<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;oops!&#34;</span>);  <span style="color:#75715e">// bug in the TwitterApi SDK.</span>
</span></span><span style="display:flex;"><span>            e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Adding Rules;</span>
</span></span><span style="display:flex;"><span>        twitterListener.<span style="color:#a6e22e">addRule</span>( <span style="color:#e6db74">&#34;potus -is:retweet&#34;</span>, <span style="color:#e6db74">&#34;Non-retweeted potus tweets&#34;</span>, dryRun);
</span></span><span style="display:flex;"><span>        twitterListener.<span style="color:#a6e22e">addRule</span>( <span style="color:#e6db74">&#34;hockey -is:retweet&#34;</span>, <span style="color:#e6db74">&#34;Non-retweeted hockey tweets&#34;</span>, dryRun);
</span></span><span style="display:flex;"><span>        twitterListener.<span style="color:#a6e22e">addRule</span>( <span style="color:#e6db74">&#34;baseball -is:retweet&#34;</span>, <span style="color:#e6db74">&#34;Non-retweeted baseball tweets&#34;</span>, dryRun);
</span></span><span style="display:flex;"><span>        twitterListener.<span style="color:#a6e22e">addRule</span>( <span style="color:#e6db74">&#34;bitcoin -is:retweet&#34;</span>, <span style="color:#e6db74">&#34;Non-retweeted bitcoin tweets&#34;</span>, dryRun);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Filter twitter stream;</span>
</span></span><span style="display:flex;"><span>        twitterListener.<span style="color:#a6e22e">searchStream</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h4 id="fine-tuning-the-kafka-producer">Fine-tuning the Kafka producer</h4>
<h5 id="producers-acks">Producers Acks</h5>
<h6 id="acks0">acks=0</h6>
<ul>
<li>no response is requested</li>
<li>may loose data if broker goes offline</li>
<li>it is okay when lost of data is acceptable:
<ul>
<li>metrics collection</li>
<li>log collection</li>
</ul>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Producer             Broker 101 partition 0 (leader)
</span></span><span style="display:flex;"><span>--------             -------------------------------
</span></span><span style="display:flex;"><span>    |                               |
</span></span><span style="display:flex;"><span>    +-----[send data to leader]----&gt;+
</span></span><span style="display:flex;"><span>    |                               |</span></span></code></pre></div>
<h6 id="acks1-default-as-kafka-v20">acks=1 (default as Kafka v2.0)</h6>
<ul>
<li>leader response is requestion (no guarantee of replication)</li>
<li>the producer may retry if the tack isn&rsquo;t received</li>
<li>data loss is possible if <code>leader broker</code> goes offline and <code>replcas</code> haven&rsquo;t replicated the data yet</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Producer             Broker 101 partition 0 (leader)
</span></span><span style="display:flex;"><span>--------             -------------------------------
</span></span><span style="display:flex;"><span>    |                               |
</span></span><span style="display:flex;"><span>    +----[send data to leader]-----&gt;+
</span></span><span style="display:flex;"><span>    |                               |
</span></span><span style="display:flex;"><span>    +&lt;---[respond write reqs]-------+
</span></span><span style="display:flex;"><span>    |                               |</span></span></code></pre></div>
<h6 id="acksall-replicas-acks">acks=all (replicas acks)</h6>
<ul>
<li>leader and replicas acks are requested</li>
<li>adding latency and safety</li>
<li>no data loss if enough replicas</li>
<li><strong>needed setting to avoid losing data</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Producer             Broker 101 part0 (leader)    Broker 102 part0 (replica)    Broker 103 part0 (replica)
</span></span><span style="display:flex;"><span>--------             -------------------------    --------------------------    --------------------------
</span></span><span style="display:flex;"><span>    |                            |                            |                            |
</span></span><span style="display:flex;"><span>    +---[send data to leader]---&gt;+                            |                            |
</span></span><span style="display:flex;"><span>    |                            |                            |                            |
</span></span><span style="display:flex;"><span>    |                            +-----[send to replica]-----&gt;+                            |
</span></span><span style="display:flex;"><span>    |                            |                            |                            |
</span></span><span style="display:flex;"><span>    |                            +-----[send to replicas]---------------------------------&gt;+
</span></span><span style="display:flex;"><span>    |                            |                            |                            |
</span></span><span style="display:flex;"><span>    |                            +&lt;--------[ack write]--------+                            |
</span></span><span style="display:flex;"><span>    |                            |                            |                            |
</span></span><span style="display:flex;"><span>    |                            +&lt;--------[ack write]-------------------------------------+
</span></span><span style="display:flex;"><span>    |                            |                            |                            |
</span></span><span style="display:flex;"><span>    +&lt;---[respond write reqs]----+                            |                            |
</span></span><span style="display:flex;"><span>    |                            |</span></span></code></pre></div>
<h5 id="mininsyncreplicas">min.insync.replicas</h5>
<ul>
<li>the <code>acks=all</code> must be used along with <code>min.insync.replicas</code></li>
<li>it can be set at the proker or topic level (override)</li>
<li><code>min.insync.replicas=2</code> means that at least 2 brokers that are ISR (incuding leader) must do the write aknowledgement
<ul>
<li>e.g., with <code>replication.factor=3</code>, the <code>min.insync.replicas=2</code> and <code>acks=all</code> then only 1 broker can go down or the producer will receive an exception on the <code>send</code> operation</li>
</ul>
</li>
</ul>
<h5 id="producer-retries">Producer retries</h5>
<ul>
<li>developers are expected to handle the exceptions or the data may be lost:
<ul>
<li>e.g., transcient failure: <code>NotEnoughReplicasException</code></li>
</ul>
</li>
<li>a <code>retries</code> setting is available:
<ul>
<li>default is <code>0</code></li>
<li>no limits to the retries, i.e., <code>Interger.MAX_VALUE</code></li>
<li>in case of retries, there is a change that the messages will be sent in wrong order</li>
<li>relying on key-based ordering may be an issue</li>
<li><code>max.in.flight.requests.per.connection</code> (default=5) can be used to help fixing message ordering issue, where <code>max.in.flight.requests.per.connection=1</code> will ensure ordering, and slow down the throughput.</li>
<li>Idempotent producer can be used to help with ordering issues if Kafka version is &gt;= 1.0.0</li>
</ul>
</li>
</ul>
<h5 id="idempotent-producer">Idempotent producer</h5>
<ul>
<li>using <code>kafka &gt;= 0.11</code> - an idempotent producer can be defined, which will solve the duplicates due to network issues (i.e., if ack is lost on the network)</li>
<li>idempotent producers are great to guarantee a stable and safe pipeline</li>
<li>it comes with when using <code>producerProps.put(&quot;enable.idempotence&quot;, true)</code>:
<ul>
<li><code>retries=Integer.MAX_VALUE</code></li>
<li><code>max.in.flight.requests=1</code> with Kafka &gt;= 0.11 and &lt; 1.1</li>
<li><code>max.in.flight.requests=5</code> with Kafka &gt;= 1.1 for higher performance</li>
<li><code>acks=all</code></li>
</ul>
</li>
<li>The <code>min.insync.replicas=2</code> must also be specified since <code>enable.idempotence=true</code> property doesn&rsquo;t imply this configuration</li>
<li>Note: running <em>safe producer</em> might impact the throughput or lantency, and therefore the <code>use case</code> must be verified to make sure the producer is within the NFR expectations</li>
</ul>
<p>An example of Producer settings to improve safeness:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        <span style="color:#75715e">// Make a safer producer</span>
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">ENABLE_IDEMPOTENCE_CONFIG</span>, <span style="color:#e6db74">&#34;true&#34;</span>);
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">ACKS_CONFIG</span>, <span style="color:#e6db74">&#34;all&#34;</span>);  <span style="color:#75715e">// default value with Idempotence=true</span>
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">RETRIES_CONFIG</span>, Integer.<span style="color:#a6e22e">toString</span>(Integer.<span style="color:#a6e22e">MAX_VALUE</span>)); <span style="color:#75715e">// default value with Idempotence=true</span>
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION</span>, <span style="color:#e6db74">&#34;5&#34;</span>); <span style="color:#f92672">//</span> with kafka <span style="color:#f92672">&gt;=</span> 2.<span style="color:#a6e22e">0</span>, otherwise use 1.</span></span></code></pre></div>
<h5 id="message-compression">Message compression</h5>
<p>Some compression benchmarks can be found the this blog: <a href="https://blog.cloudflare.com/squeezing-the-firehose/" rel="external" target="_blank">Squeezing the firehose: getting the most from Kafka compression</a></p>
<ul>
<li>producer usually send data text-based (json) messages</li>
<li>compression is set at the producer configuration only no needs for consumer or broker configuration</li>
<li>the <code>compression.type</code> can be <code>none</code> (default), <code>gzip</code>, <code>lz4</code> and <code>snappy</code></li>
<li>compression will improve the throughput and performance</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>+----------------+       +--------------------+      +---------------+
</span></span><span style="display:flex;"><span>| Producer Batch |------&gt;| Compression of the |-----&gt;| Kafka Cluster |
</span></span><span style="display:flex;"><span>+----------------+       | batch of messages  |      +---------------+
</span></span><span style="display:flex;"><span>                         +--------------------+</span></span></code></pre></div>
<p>Compression advantages:</p>
<ul>
<li>smaller producer request size (compression up to 4x)</li>
<li>faster to tranfer data over the network</li>
<li>better throughput</li>
<li>better disk utilisation in Kafka cluster</li>
</ul>
<p>Compression disavantages:</p>
<ul>
<li>producers and consumers must commit CPU time for compression/decompression</li>
</ul>
<p>Overall:</p>
<ul>
<li>snappy and lz4 are optimal for speed/compression ratio</li>
<li>recommendations are to try the algorithms in a given use case and environment</li>
<li>always use compression in prod</li>
<li>should use along with <code>linger.ms</code> and <code>batch.size</code> configuration settings</li>
</ul>
<h5 id="configuration-lingerms-and-batchsize">Configuration: linger.ms and batch.size</h5>
<ul>
<li>Kafka producer default behavior is to send records as soon as possible
<ul>
<li>it will have up to 5 requests in flight (batch)</li>
<li>batching messages are done simultaneously with messages are in-flight (no time wasted)</li>
</ul>
</li>
<li>smart batching allows kafka to increase throughput while maintaining very low latency</li>
<li><code>linger.ms</code> is the number of ms (default=0) that the producer is willing to wait to fully get a batch of messages
<ul>
<li>by introducing some lag (e.g., linger.ms=5) then we increase the cahnges of messages being sent together in a batch</li>
<li>at the cost of introducing a small delay (e.g., 5 ms) then the throughput can be increased, the compression is more efficient and the producer efficiency is better</li>
</ul>
</li>
<li><code>batch.size</code> is the maximum mumber of bytes (default=16KB) that will be included in a batch</li>
<li>increasing a batch size to higher number (32KB or 64KB) can help increasing the ompression, throughput, and efficiency of requests</li>
<li>any message tha is bigger than a batch size will not be batched</li>
<li>the producer will make or allocate a batch per partition</li>
<li>the average batch size metric can be monitored by using the Kafka Producer Metrics</li>
</ul>
<p>An example of Producer settings to improve efficiency:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        <span style="color:#75715e">// Improve throughput efficiency of the producer</span>
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">COMPRESSION_TYPE_CONFIG</span>, <span style="color:#e6db74">&#34;snappy&#34;</span>);
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">LINGER_MS_CONFIG</span>, <span style="color:#e6db74">&#34;20&#34;</span>);
</span></span><span style="display:flex;"><span>        properties.<span style="color:#a6e22e">setProperty</span>(ProducerConfig.<span style="color:#a6e22e">BATCH_SIZE_CONFIG</span>, <span style="color:#e6db74">&#34;32768&#34;</span>);  <span style="color:#f92672">//</span> 32 KB</span></span></code></pre></div>
<h5 id="producer-default-partition-and-key-hashing">Producer default partition and key hashing</h5>
<ul>
<li>The default key are hashed using <code>murmur2</code> algorithm</li>
<li>it is possible - but maybe not suggested - to override the partitioner behavior using <code>partitioner.class</code></li>
<li>the formula from Kafka code: <code>targetPartition = Utils.abs(Utils.murmur2(record.key())) % numPartitions;</code></li>
<li>therfore the same key will <em>always</em> go to the same partition</li>
<li>changing the number of partition will cause key vs partition issues and should be avoided</li>
</ul>
<h5 id="maxblocksms-and-buffermemory">Max.blocks.ms and buffer.memory</h5>
<p>These are advanced settings and it is probably better to avoid tweaking them unless necessary.</p>
<ul>
<li>when the producer prodeuces faster tahn the broker can handle then the records will be memory buffered</li>
<li>the <code>buffer.memory</code> is the size of the buffer (default is 32MB)</li>
<li>a full buffer (e.g., full 32MB) will cause the <code>producer.send()</code> method to block (or wait)</li>
<li>the <code>max.block.ms</code> (default=60000ms) is the waiting time befre the producer.send() method throw an exception, and causes are:
<ul>
<li>the producer has filled up the buffer</li>
<li>the broker is not accepting any new data</li>
<li>60s has elapsed</li>
</ul>
</li>
<li>An exception may mean that the broker is down or overloaded as it can&rsquo;t handle the requests</li>
</ul>
<h4 id="elastic-search">Elastic Search</h4>
<h5 id="adding-elasticsearch-docker-container">Adding elasticsearch docker container</h5>
<p>The following must be added in order to add an <code>elastic search</code> container or server to the kafka-cluster:</p>
<p>docker-compose.yaml:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>  <span style="color:#f92672">elasticsearch</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">docker.elastic.co/elasticsearch/elasticsearch:7.5.2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9200</span>:<span style="color:#ae81ff">9200</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9300</span>:<span style="color:#ae81ff">9300</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">discovery.type</span>: <span style="color:#ae81ff">single-node</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">node.name</span>: <span style="color:#ae81ff">es01</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cluster.name</span>: <span style="color:#ae81ff">kafka-cluster</span></span></span></code></pre></div>
<p>To start the service from docker-compose:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; docker-compose up elasticsearch -d
</span></span><span style="display:flex;"><span>&gt; docker-compose ps
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                            COMMAND                  SERVICE             STATUS              PORTS
</span></span><span style="display:flex;"><span>kafka-cluster-elasticsearch-1   <span style="color:#e6db74">&#34;/usr/local/bin/dock…&#34;</span>   elasticsearch       running             0.0.0.0:9200-&gt;9200/tcp, 0.0.0.0:9300-&gt;9300/tcp
</span></span><span style="display:flex;"><span>kafka-cluster-kafka-1           <span style="color:#e6db74">&#34;/etc/confluent/dock…&#34;</span>   kafka               running             0.0.0.0:29092-&gt;29092/tcp
</span></span><span style="display:flex;"><span>kafka-cluster-zookeeper-1       <span style="color:#e6db74">&#34;/etc/confluent/dock…&#34;</span>   zookeeper           running             0.0.0.0:22181-&gt;2181/tcp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt; curl localhost:9200/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;es01&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;cluster_name&#34;</span> : <span style="color:#e6db74">&#34;kafka-cluster&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;cluster_uuid&#34;</span> : <span style="color:#e6db74">&#34;-w05UbWdSeOhc4nRGcy8yA&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;version&#34;</span> : <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;number&#34;</span> : <span style="color:#e6db74">&#34;7.5.2&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;build_flavor&#34;</span> : <span style="color:#e6db74">&#34;default&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;build_type&#34;</span> : <span style="color:#e6db74">&#34;docker&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;build_hash&#34;</span> : <span style="color:#e6db74">&#34;8bec50e1e0ad29dad5653712cf3bb580cd1afcdf&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;build_date&#34;</span> : <span style="color:#e6db74">&#34;2020-01-15T12:11:52.313576Z&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;build_snapshot&#34;</span> : false,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;lucene_version&#34;</span> : <span style="color:#e6db74">&#34;8.3.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;minimum_wire_compatibility_version&#34;</span> : <span style="color:#e6db74">&#34;6.8.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;minimum_index_compatibility_version&#34;</span> : <span style="color:#e6db74">&#34;6.0.0-beta1&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;tagline&#34;</span> : <span style="color:#e6db74">&#34;You Know, for Search&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div>
<h5 id="java-elasticsearch-client">Java elasticsearch client</h5>
<p>The following packages are required:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>    implementation group: <span style="color:#e6db74">&#39;org.elasticsearch.client&#39;</span><span style="color:#f92672">,</span> name: <span style="color:#e6db74">&#39;elasticsearch-rest-high-level-client&#39;</span><span style="color:#f92672">,</span> version: <span style="color:#e6db74">&#39;7.14.0&#39;</span>
</span></span><span style="display:flex;"><span>    implementation group: <span style="color:#e6db74">&#39;org.apache.logging.log4j&#39;</span><span style="color:#f92672">,</span> name: <span style="color:#e6db74">&#39;log4j-core&#39;</span><span style="color:#f92672">,</span> version: <span style="color:#e6db74">&#39;2.17.2&#39;</span> <span style="color:#e6db74">//</span> Elastic search dependency</span></span></code></pre></div>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ElasticsearchClient</span> {
</span></span><span style="display:flex;"><span>    Logger logger <span style="color:#f92672">=</span> LoggerFactory.<span style="color:#a6e22e">getLogger</span>(ElasticsearchClient.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> RestHighLevelClient restHighLevelClient;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ElasticsearchClient</span>() {
</span></span><span style="display:flex;"><span>        restHighLevelClient <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RestHighLevelClient(
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// TODO: use configuration file or environment variables to set ip and ports, now configured for local docker containers.</span>
</span></span><span style="display:flex;"><span>                RestClient.<span style="color:#a6e22e">builder</span>(<span style="color:#66d9ef">new</span> HttpHost(<span style="color:#e6db74">&#34;localhost&#34;</span>, 9200, <span style="color:#e6db74">&#34;http&#34;</span>),
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">new</span> HttpHost(<span style="color:#e6db74">&#34;localhost&#34;</span>, 9300, <span style="color:#e6db74">&#34;http&#34;</span>)));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> RestHighLevelClient <span style="color:#a6e22e">getRestHighLevelClient</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> restHighLevelClient;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">ping</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">boolean</span> result <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">=</span> getRestHighLevelClient().<span style="color:#a6e22e">ping</span>(RequestOptions.<span style="color:#a6e22e">DEFAULT</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            logger.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;Elasticsearch client received an exception.&#34;</span>, e);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            logger.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Elasticsearch aliveness: &#34;</span> <span style="color:#f92672">+</span> result);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> IndexResponse <span style="color:#a6e22e">toIndex</span>(String index, String jsonSource, String id) {
</span></span><span style="display:flex;"><span>        IndexRequest indexRequest <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> IndexRequest(index)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">id</span>(id) <span style="color:#75715e">// Make the entry idempotent.</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">source</span>(jsonSource, XContentType.<span style="color:#a6e22e">JSON</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        IndexResponse indexResponse <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            indexResponse <span style="color:#f92672">=</span> getRestHighLevelClient().<span style="color:#a6e22e">index</span>(indexRequest, RequestOptions.<span style="color:#a6e22e">DEFAULT</span>);
</span></span><span style="display:flex;"><span>            logger.<span style="color:#a6e22e">info</span>(indexResponse.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            logger.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;Caught and exception.&#34;</span>, e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> indexResponse;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            getRestHighLevelClient().<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            logger.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;Caught and exception.&#34;</span>, e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        Logger logger <span style="color:#f92672">=</span> LoggerFactory.<span style="color:#a6e22e">getLogger</span>(ElasticsearchClient.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Setup Elasticsearch</span>
</span></span><span style="display:flex;"><span>        ElasticsearchClient elasticsearchClient <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ElasticsearchClient();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        elasticsearchClient.<span style="color:#a6e22e">ping</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Setup Kafka Consumer</span>
</span></span><span style="display:flex;"><span>        TwitterKafkaConsumer twitterKafkaConsumer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TwitterKafkaConsumer();
</span></span><span style="display:flex;"><span>        twitterKafkaConsumer.<span style="color:#a6e22e">subscribe</span>(<span style="color:#e6db74">&#34;twitter_tweets&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Get data using Kafka Consumer and insert data to the elasticsearch</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span>(<span style="color:#66d9ef">true</span>) { <span style="color:#75715e">// TODO: replace with better logic.</span>
</span></span><span style="display:flex;"><span>            ConsumerRecords<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> records <span style="color:#f92672">=</span> twitterKafkaConsumer.<span style="color:#a6e22e">poll</span>(Duration.<span style="color:#a6e22e">ofMillis</span>(100));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            records.<span style="color:#a6e22e">forEach</span>(record <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>                FilteredStreamingTweetResponse tweet <span style="color:#f92672">=</span> twitterKafkaConsumer.<span style="color:#a6e22e">mapTweetToObject</span>(record.<span style="color:#a6e22e">value</span>());
</span></span><span style="display:flex;"><span>                elasticsearchClient.<span style="color:#a6e22e">toIndex</span>(<span style="color:#e6db74">&#34;twitter&#34;</span>, record.<span style="color:#a6e22e">value</span>(), tweet.<span style="color:#a6e22e">getData</span>().<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                logger.<span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#34;Key: &#34;</span> <span style="color:#f92672">+</span> record.<span style="color:#a6e22e">key</span>()
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Value: &#34;</span> <span style="color:#f92672">+</span> record.<span style="color:#a6e22e">value</span>()
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Partition: &#34;</span> <span style="color:#f92672">+</span> record.<span style="color:#a6e22e">partition</span>()
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Offset: &#34;</span> <span style="color:#f92672">+</span> record.<span style="color:#a6e22e">offset</span>()
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Timestamp: &#34;</span> <span style="color:#f92672">+</span> record.<span style="color:#a6e22e">timestamp</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    Thread.<span style="color:#a6e22e">sleep</span>(1000);
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                    logger.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;Error while waiting for sleep&#34;</span>, e);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Tear-down the Elasticsearch</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//        elasticsearchClient.close();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Tear-down the Kafka Consumer</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h4 id="kafka-delivery-semantics">Kafka delivery semantics</h4>
<p>The <code>at least once</code> processing should used for most applications along with <code>idempotent</code> strategy.</p>
<h5 id="at-most-once">At most once</h5>
<p>Offsets are committed as soon as the message batch is received. If the processing oes wrong, the message will be lost (it won&rsquo;t be read again)</p>
<h5 id="at-least-once">At least once</h5>
<p>Offsets are committed after the message is processed. If the processing goes wrong, the message will be read again. This can resilt in duplicate processing of messages. Idempotence of the messages is needed to avoid duplicates.</p>
<h5 id="exactly-once">Exactly once</h5>
<p>Can be achieved for kafka-to-kafka workflows using kafka streams APIs. For the Kafka-to-Sink workflows, idempotent consumer is needed.</p>
<h4 id="idempotentce-and-offset-auto-commit">Idempotentce and offset auto-commit</h4>
<p>The default configuration (<code>ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG=&quot;enable.auto.commit&quot;</code>) setting is <code>at-least-once</code> if not specified otherwise.</p>
<p>To avoid duplicate entries, the usage of a unique key will be required. An example would be the Twitter ID.</p>
<h4 id="consumer-poll-behaviours">Consumer Poll Behaviours</h4>
<p>Default values should be correct in most cases but the following can be adjuested.</p>
<ul>
<li>
<p><code>fetch.min.bytes</code> (default=1):</p>
<ul>
<li>controls the minimum data to pull on each request</li>
<li>help improving throughput and decreasing request numbr</li>
<li>cost is latency</li>
</ul>
</li>
<li>
<p><code>max.poll.records</code> (default=500):</p>
<ul>
<li>controls the number of records to receive per poll request</li>
<li>increase if the messages are very small and if RAM is available</li>
<li>best practices tell to monitor the number of records per poll request and to adjust to increase the value if default value is often reached</li>
</ul>
</li>
<li>
<p><code>max-partitions.fetch.bytes</code> (default=1MB):</p>
<ul>
<li>maximum data returned by the broker per partition</li>
<li>reading from many partions will require a lot of memory</li>
</ul>
</li>
<li>
<p><code>fetch.max.bytes</code> (default 50MB):</p>
<ul>
<li>max data returned for each fetch request (covers multiple partitions)</li>
<li>the consumer performs multiple fetches in parallel</li>
</ul>
</li>
</ul>
<h4 id="consumer-offset-commits-strategies">Consumer Offset Commits Strategies</h4>
<p>The two strategies:</p>
<ul>
<li>
<p><code>enable.auto.commit=true</code> and syncrhonous processing of record batches (default)</p>
<ul>
<li>
<p>pseudocode:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">while</span>(<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>    List<span style="color:#f92672">&lt;</span>Records<span style="color:#f92672">&gt;</span> records <span style="color:#f92672">=</span> consumer.<span style="color:#a6e22e">poll</span>(Duration.<span style="color:#a6e22e">ofMillis</span>(100));
</span></span><span style="display:flex;"><span>    doSomethingSunchronous(records);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<ul>
<li>offsets get automatically commited at regular interval <code>auto.commit.interval.ms=5000</code> (default)</li>
<li>Note: using asyncrhonous processing would make the delivery sementic to <code>at-most-once</code> since the offset will be committed before the data is processes</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>enable.auto.commit=false</code> and manual commit of offsets</p>
<ul>
<li>
<p>pseudocode:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">while</span>(<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>    records <span style="color:#f92672">+=</span> consumer.<span style="color:#a6e22e">poll</span>(Duration.<span style="color:#a6e22e">ofMillis</span>(100));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> isReady(records) {
</span></span><span style="display:flex;"><span>        doSomethingSynchronous(records);
</span></span><span style="display:flex;"><span>        consumer.<span style="color:#a6e22e">commitSync</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</li>
<li>
<p>offsets commit is controlled according to the expected conditions</p>
</li>
<li>
<p>E.g., accumulation recortds into a buffer and then flushing the buffer to a DB, then offsets are committed</p>
</li>
</ul>
</li>
</ul>
<h5 id="manual-commits">Manual commits</h5>
<p>Settings to be configured to avoid offsets auto commits:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">ENABLE_AUTO_COMMIT_CONFIG</span>,<span style="color:#e6db74">&#34;false&#34;</span>); <span style="color:#75715e">// Will require manual offsets commits</span>
</span></span><span style="display:flex;"><span>properties.<span style="color:#a6e22e">setProperty</span>(ConsumerConfig.<span style="color:#a6e22e">MAX_POLL_RECORDS_CONFIG</span>, <span style="color:#e6db74">&#34;10&#34;</span>); <span style="color:#f92672">//</span> Only retrieve 10 records at the time</span></span></code></pre></div>
<p>The syncronous commit command for the consumer - pseudocode:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">while</span>(<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>    ConsumerRecords<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> records <span style="color:#f92672">=</span> twitterKafkaConsumer.<span style="color:#a6e22e">poll</span>(Duration.<span style="color:#a6e22e">ofMillis</span>(100));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    logger.<span style="color:#a6e22e">info</span>(String.<span style="color:#a6e22e">format</span>(<span style="color:#e6db74">&#34;Received %s records&#34;</span>, records.<span style="color:#a6e22e">count</span>()));
</span></span><span style="display:flex;"><span>    records.<span style="color:#a6e22e">forEach</span>(record <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// do something synchronous here...</span>
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    logger.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Committing offsets&#34;</span>);
</span></span><span style="display:flex;"><span>    twitterKafkaConsumer.<span style="color:#a6e22e">commitSync</span>();
</span></span><span style="display:flex;"><span>    logger.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Offsets were committed&#34;</span>);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Using <code>kafka-console-consumer</code> command:</p>
<ul>
<li>looking at the offsets for given group <code>kafka-java-demo-elasticsearch</code>:</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kafka-consumer-groups --bootstrap-server localhost:9092 --group kafka-java-demo-elasticsearch --describe
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Consumer group <span style="color:#e6db74">&#39;kafka-java-demo-elasticsearch&#39;</span> has no active members.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GROUP                         TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch twitter_tweets  <span style="color:#ae81ff">3</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">39</span>              <span style="color:#ae81ff">39</span>              -
</span></span><span style="display:flex;"><span> -               -
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch twitter_tweets  <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">37</span>              <span style="color:#ae81ff">37</span>              -
</span></span><span style="display:flex;"><span> -               -
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch twitter_tweets  <span style="color:#ae81ff">4</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">63</span>              <span style="color:#ae81ff">63</span>              -
</span></span><span style="display:flex;"><span> -               -
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch twitter_tweets  <span style="color:#ae81ff">5</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">43</span>              <span style="color:#ae81ff">43</span>              -
</span></span><span style="display:flex;"><span> -               -
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch twitter_tweets  <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">37</span>              <span style="color:#ae81ff">37</span>              -
</span></span><span style="display:flex;"><span> -               -
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch twitter_tweets  <span style="color:#ae81ff">1</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">58</span>              <span style="color:#ae81ff">58</span>              -
</span></span><span style="display:flex;"><span> -               -
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<ul>
<li>consuming records using <code>Java</code> consumer and verifying the offsets:</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-consumer-groups --bootstrap-server localhost:9092 --group kafka-java-demo-elasticsearch --describe
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Consumer group <span style="color:#e6db74">&#39;kafka-java-demo-elasticsearch&#39;</span> has no active members.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GROUP                         TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch twitter_tweets  <span style="color:#ae81ff">3</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">39</span>              <span style="color:#ae81ff">39</span>              -
</span></span><span style="display:flex;"><span> -               -
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch twitter_tweets  <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">37</span>              <span style="color:#ae81ff">37</span>              -
</span></span><span style="display:flex;"><span> -               -
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch twitter_tweets  <span style="color:#ae81ff">4</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">63</span>              <span style="color:#ae81ff">63</span>              -
</span></span><span style="display:flex;"><span> -               -
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch twitter_tweets  <span style="color:#ae81ff">5</span>          <span style="color:#ae81ff">30</span>              <span style="color:#ae81ff">43</span>              <span style="color:#ae81ff">13</span>              -
</span></span><span style="display:flex;"><span> -               -
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch twitter_tweets  <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">37</span>              <span style="color:#ae81ff">37</span>              -
</span></span><span style="display:flex;"><span> -               -
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch twitter_tweets  <span style="color:#ae81ff">1</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">58</span>              <span style="color:#ae81ff">58</span>              -
</span></span><span style="display:flex;"><span> -               -
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<ul>
<li>Note: the current offset for the partition 5 (above example) should be a multiple of <code>ConsumerConfig.MAX_POLL_RECORDS_CONFIG</code> property value, any record (modulo) will be consumed again since the offset wasn&rsquo;t committed</li>
</ul>
<h4 id="consumer-offset-reset-behaviour">Consumer offset reset behaviour</h4>
<p>The offset reset available behaviours are:</p>
<ul>
<li><code>auto.offset.reset=latest</code> which will read from the end of the log</li>
<li><code>auto.offset.reset=earliest</code> which will read from start of the log</li>
<li><code>auto.offset.reset=none</code> which will throw exception if no offset is found</li>
</ul>
<p>The consumer offsets can be lost:</p>
<ul>
<li>if a consumer hasn&rsquo;t read new data for 1 day (kafka &lt; 2.0)</li>
<li>if a consumner hasn&rsquo;t read new data for 7 days (kafka &gt;= 2.0)</li>
</ul>
<p>The retention delay can be set using the broker setting <code>offset.retention.minutes</code>. Proper data and offset retention period must be set to ensure no data loss if a server can go down for a while, e.g., 30 days.</p>
<h4 id="replaying-the-data-for-a-consumner-group">Replaying the data for a consumner group</h4>
<p>To reset kafka server offsets and replay messages from beginning:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ kafka-consumer-groups --bootstrap-server localhost:9092 --topic twitter_tweets --group kafka-java-demo-elasticse
</span></span><span style="display:flex;"><span>arch --reset-offsets --to-earliest --execute
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GROUP                          TOPIC                          PARTITION  NEW-OFFSET
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch  twitter_tweets                 <span style="color:#ae81ff">3</span>          <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch  twitter_tweets                 <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch  twitter_tweets                 <span style="color:#ae81ff">4</span>          <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch  twitter_tweets                 <span style="color:#ae81ff">5</span>          <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch  twitter_tweets                 <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>kafka-java-demo-elasticsearch  twitter_tweets                 <span style="color:#ae81ff">1</span>          <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<p>This allows to restart the consumer and replay the messages; having an idempotent server will make replays safe.</p>
<h4 id="controlling-consumer-liveliness">Controlling Consumer Liveliness</h4>
<ul>
<li>consumers in a <code>group</code> talk to a <code>Consumer Group Coordinator</code></li>
<li>there is a <code>heartbeat</code> and a <code>pool</code> mechanism to detect if consumers are down</li>
<li>best practices tell that a process should process data fast and poll often</li>
</ul>
<p>Consumer Heartbeat Thread:</p>
<ul>
<li>
<p><code>session.timeout.ms</code> (default=10s)</p>
<ul>
<li>heardbeets are sent periodically to broker</li>
<li>if no heartbeat is sent during that period, the consumer is considered dead</li>
<li>set low value to faster consumer rebalancing</li>
</ul>
</li>
<li>
<p><code>heartbeat.interval.ms</code> (default=3s)</p>
<ul>
<li>wait period between 2 heartbeats</li>
<li>best pratices tell to set 1/3rd of the <code>session.timeout.ms</code> value</li>
</ul>
</li>
<li>
<p>both settings are set together to detect a dead consumer application (down)</p>
</li>
</ul>
<p>Consumer Poll Thread:</p>
<ul>
<li>
<p><code>max.poll.interval.ms</code> (default=5m)</p>
<ul>
<li>maximum time between 2 poll() alls before declaring the consumer is dead</li>
<li>relevant for Big Data frameworks (e.g., Spark) in case processing takes time</li>
</ul>
</li>
<li>
<p>mecahnism to detect a data processing issue with the consumer</p>
</li>
</ul>
<h3 id="kafka-connect-and-kafka-stream">Kafka Connect and Kafka Stream</h3>
<ul>
<li>There are 4 Kafka use cases:
<ul>
<li>Source to Kafka =&gt; Producer API =&gt; Kafka Connect Source</li>
<li>Kafka to Kafka =&gt; Consumer API/Producer API =&gt; Kafka Streams</li>
<li>Kafka =&gt; Sink =&gt; Consumer API =&gt; Kafka Connect Sink</li>
<li>Kafka =&gt; Application =&gt; Consumer API =&gt;</li>
</ul>
</li>
<li>Kafka connect and Kafka stream will simplify and improve the in/out of Kafka</li>
<li>Kafka connect and Kafka stream will simplify transforming data within kafka withou relying on external libraries</li>
</ul>
<p>The Kafka connectors can be found on the <a href="https://www.confluent.io/product/confluent-connectors" rel="external" target="_blank">Confluent Kafka Connectors</a> page.</p>
<h4 id="why-kafka-connect">Why Kafka Connect?</h4>
<ul>
<li>developpers always want to import data from the same sources: DB, JDBC, Couchbase, Goldergate, SAP HANA, Blockchain, Cassandra, DynamoDB, FTP, IOT, MongoDB, MQTT, RethinkDB, Salesforce, Solr, SQS, Twitter, etc.</li>
<li>developpers always want to store data in the same sinks: S3, ElasticSearch, HDFS, JDBC, SAP HANA, DocumentDB, Cassandra, DynamoDB, HBase, MongoDB, Redis, Solr, Splunk, Twitter, etc.</li>
<li>an <em>unexperimented developper</em> may struggle to achieve fault tolerance, idempotence, distribution, ordering, etc.</li>
<li>an <em>experimented developper</em>  already did the work for others.</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Sources/Destinations     Connect Cluster             Kafka Cluster          Stream Apps
</span></span><span style="display:flex;"><span>--------------------     ---------------             -------------          -----------
</span></span><span style="display:flex;"><span>     [source1]-------------&gt;[worker]                   [broker]--------------&gt;[app1]
</span></span><span style="display:flex;"><span>                            [worker]------------------&gt;[broker]&lt;--------------
</span></span><span style="display:flex;"><span>     [source2]              [worker]                   [broker]
</span></span><span style="display:flex;"><span>                            [worker]&lt;------------------[broker]--------------&gt;[app2]
</span></span><span style="display:flex;"><span>      [sinks]&lt;--------------[worker]                           &lt;--------------</span></span></code></pre></div>
<h5 id="kafka-connect-high-level">Kafka Connect: High level</h5>
<ul>
<li>source connectors to get data from Common Data Sources</li>
<li>sink connectors to publish data in common data stores</li>
<li>make it easy for non-experienced developpers to quickly get data in kafka</li>
<li>part of the ETL pipeline (Extract, Transform and Load)</li>
<li>scaling made easy from small pipelines to company-wide pipelines</li>
<li>re-usable code</li>
</ul>
<h5 id="adding-a-connector-to-a-java-project">Adding a connector to a Java project</h5>
<p>The connector <a href="https://www.confluent.io/hub/jcustenborder/kafka-connect-twitter" rel="external" target="_blank">kafka-connect-twitter</a> will be used as an example to show file structure:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>+ [my-java-project]
</span></span><span style="display:flex;"><span>+-+ [kafka-connect] (to be created with sub folders)
</span></span><span style="display:flex;"><span>| +-+ [connectors]
</span></span><span style="display:flex;"><span>| | +-+ [kafka-connect-twitter] (downloaded connector project from github)
</span></span><span style="display:flex;"><span>| | | +-+ *.jar
</span></span><span style="display:flex;"><span>| | +-+ connector-standalone.properties
</span></span><span style="display:flex;"><span>| | | + run.sh
</span></span><span style="display:flex;"><span>| | | + twitter.properties</span></span></code></pre></div>
<h5 id="connect-standalone-cli-command">Connect standalone CLI command</h5>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sh-4.4$ connect-standalone
</span></span><span style="display:flex;"><span>USAGE: /usr/bin/connect-standalone <span style="color:#f92672">[</span>-daemon<span style="color:#f92672">]</span> connect-standalone.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh-4.4$</span></span></code></pre></div>
<p>Creating a new topic for the kafka connector:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kafka-topics --bootstrap-server localhost:9092 --create --topic twitter_status_connect --parti
</span></span><span style="display:flex;"><span>tions <span style="color:#ae81ff">3</span> --replication-factor <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>WARNING: Due to limitations in metric names, topics with a period <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;.&#39;</span><span style="color:#f92672">)</span> or underscore <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;_&#39;</span><span style="color:#f92672">)</span> could collide. To avoid issues it is best to use either, but not both.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Created topic twitter_status_connect.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kafka-topics --bootstrap-server localhost:9092 --create --topic twitter_deletes_connect --part
</span></span><span style="display:flex;"><span>itions <span style="color:#ae81ff">3</span> --replication-factor <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>WARNING: Due to limitations in metric names, topics with a period <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;.&#39;</span><span style="color:#f92672">)</span> or underscore <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;_&#39;</span><span style="color:#f92672">)</span> could collide. To avoid issues it is best to use either, but not both.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Created topic twitter_deletes_connect.
</span></span><span style="display:flex;"><span>$</span></span></code></pre></div>

  <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:abouchard@live.ca">Alain Bouchard</a>
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
<img src="/logo.png">
        </div>
        <script>
          window.index_js_url="/searchindex.js?1731979209";
        </script>
        <search><form action="/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="/js/auto-complete.js?1731979209" defer></script>
        <script src="/js/lunr/lunr.min.js?1731979209" defer></script>
        <script src="/js/lunr/lunr.stemmer.support.min.js?1731979209" defer></script>
        <script src="/js/lunr/lunr.multi.min.js?1731979209" defer></script>
        <script src="/js/lunr/lunr.en.min.js?1731979209" defer></script>
        <script src="/js/search.js?1731979209" defer></script>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <ul>
          <li><a class="padding" href="/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
        </ul>
        <hr class="padding">
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div id="R-topics">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/blogs/index.html"><a class="padding" href="/blogs/index.html">My Blogs</a><ul id="R-subsections-a69376f90f739b060662445f23838d97" class="collapsible-menu"></ul></li>
            <li class="parent " data-nav-id="/notes/index.html"><a class="padding" href="/notes/index.html">My Notes</a><ul id="R-subsections-f0aa74b4dd15f49d7073057e7daf25a4" class="collapsible-menu">
            <li class="active " data-nav-id="/notes/apache-kafka/index.html"><a class="padding" href="/notes/apache-kafka/index.html">Apache Kafka (WIP)</a></li>
            <li class="" data-nav-id="/notes/cypress/index.html"><a class="padding" href="/notes/cypress/index.html">Cypress with TypeScript</a></li>
            <li class="" data-nav-id="/notes/data-quality/index.html"><a class="padding" href="/notes/data-quality/index.html">Data Quality</a></li>
            <li class="" data-nav-id="/notes/gradle/index.html"><a class="padding" href="/notes/gradle/index.html">Gradle</a></li>
            <li class="" data-nav-id="/notes/gradle-for-java-based-applications-and-libraries/index.html"><a class="padding" href="/notes/gradle-for-java-based-applications-and-libraries/index.html">Gradle for Java-Based applications and libraries</a></li>
            <li class="" data-nav-id="/notes/hugo/index.html"><a class="padding" href="/notes/hugo/index.html">Hugo</a></li>
            <li class="" data-nav-id="/notes/intellij-ide/index.html"><a class="padding" href="/notes/intellij-ide/index.html">IntelliJ Cheat Sheet</a></li>
            <li class="" data-nav-id="/notes/java-object-oriented-programming/index.html"><a class="padding" href="/notes/java-object-oriented-programming/index.html">Java Object-Oriented Programming</a></li>
            <li class="" data-nav-id="/notes/java-spring-boot2/index.html"><a class="padding" href="/notes/java-spring-boot2/index.html">Java Spring Boot 2</a></li>
            <li class="" data-nav-id="/notes/java-rest-assured/index.html"><a class="padding" href="/notes/java-rest-assured/index.html">Java with Rest-Assured</a></li>
            <li class="" data-nav-id="/notes/javascript-best-practices/index.html"><a class="padding" href="/notes/javascript-best-practices/index.html">JavaScript Best Practices and Principles</a></li>
            <li class="" data-nav-id="/notes/java-lombok/index.html"><a class="padding" href="/notes/java-lombok/index.html">Lombok Java Library</a></li>
            <li class="" data-nav-id="/notes/mongodb/index.html"><a class="padding" href="/notes/mongodb/index.html">MongoDB</a></li>
            <li class="" data-nav-id="/notes/python-and-pytest/index.html"><a class="padding" href="/notes/python-and-pytest/index.html">Python and PyTest</a></li>
            <li class="" data-nav-id="/notes/typescript/index.html"><a class="padding" href="/notes/typescript/index.html">TypeScript</a></li></ul></li>
          </ul>
        </div>
        <div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div>
        <div id="R-menu-footer">
          <hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter">
          <div id="R-prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks">
            <ul>
              <li id="R-select-language-container" class="footerLangSwitch">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-language"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-language">Language</label>
                    <select id="R-select-language" onchange="location = this.querySelector( this.value ).dataset.url;">
                      <option id="R-select-language-en" value="#R-select-language-en" data-url="/notes/apache-kafka/index.html" lang="en-us" selected></option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
              <li id="R-select-variant-container" class="footerVariantSwitch">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-paint-brush"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-variant">Theme</label>
                    <select id="R-select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                      <option id="R-select-variant-blue" value="blue" selected>Blue</option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
                <script>window.variants && variants.markSelectedVariant();</script>
              </li>
              <li class="footerVisitedLinks">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-history"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <button onclick="clearHistory();">Clear History</button>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
            </ul>
          </div>
          <div id="R-footer" class="footerFooter showFooter">
        <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
          </div>
        </div>
      </div>
    </aside>
    <script src="/js/clipboard.min.js?1731979209" defer></script>
    <script src="/js/perfect-scrollbar.min.js?1731979209" defer></script>
    <script src="/js/theme.js?1731979209" defer></script>
  </body>
</html>
